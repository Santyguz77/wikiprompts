<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Actualizar Prompts GitHub - Wikiprompts</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap"
        rel="stylesheet" />
</head>

<body class="bg-gray-50 p-4 md:p-8">
    <div class="max-w-4xl mx-auto">
        <div class="bg-white rounded-2xl shadow-xl p-6 md:p-8">
            <div class="flex items-center gap-4 mb-6">
                <button onclick="window.location.href='admin.html'"
                    class="flex items-center justify-center size-10 rounded-full hover:bg-gray-100 transition-colors">
                    <span class="material-symbols-outlined">arrow_back</span>
                </button>
                <h1 class="text-3xl font-bold">üîß Actualizar Prompts de GitHub</h1>
            </div>

            <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6">
                <div class="flex">
                    <div class="flex-shrink-0">
                        <svg class="h-5 w-5 text-yellow-400" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd"
                                d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z"
                                clip-rule="evenodd" />
                        </svg>
                    </div>
                    <div class="ml-3">
                        <p class="text-sm text-yellow-700">
                            <strong>Advertencia:</strong> Esta herramienta actualizar√° TODOS los prompts importados
                            desde GitHub.<br>
                            Cambiar√° el autor a tu usuario y agregar√° placeholders de im√°genes.
                        </p>
                    </div>
                </div>
            </div>

            <div class="space-y-4 mb-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Nuevo autor para todos los
                        prompts:</label>
                    <input type="text" id="newAuthor" value="@santyguz77"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" />
                </div>

                <div class="flex items-center gap-2">
                    <input type="checkbox" id="addImages" checked class="w-4 h-4 text-blue-600 rounded">
                    <label for="addImages" class="text-sm text-gray-700">Agregar imagen placeholder a prompts sin
                        imagen</label>
                </div>
            </div>

            <button onclick="updatePrompts()" id="updateBtn"
                class="w-full bg-blue-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-blue-700 transition-colors flex items-center justify-center gap-2">
                <span class="material-symbols-outlined">update</span>
                Actualizar Prompts de GitHub
            </button>

            <div id="status" class="mt-6 hidden">
                <div class="bg-gray-100 rounded-lg p-4">
                    <h3 class="font-semibold mb-2">Estado:</h3>
                    <pre id="statusText"
                        class="text-sm text-gray-700 whitespace-pre-wrap max-h-96 overflow-y-auto"></pre>
                </div>
            </div>

            <div id="results" class="mt-6 hidden">
                <div class="bg-green-50 border-l-4 border-green-400 p-4">
                    <div class="flex">
                        <div class="flex-shrink-0">
                            <svg class="h-5 w-5 text-green-400" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd"
                                    d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                                    clip-rule="evenodd" />
                            </svg>
                        </div>
                        <div class="ml-3">
                            <p class="text-sm text-green-700">
                                <strong id="updateCount">0</strong> prompts actualizados exitosamente
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'https://sentences-col-vice-antivirus.trycloudflare.com/api';

        function log(message, isError = false) {
            const statusDiv = document.getElementById('status');
            const statusText = document.getElementById('statusText');
            statusDiv.classList.remove('hidden');

            const timestamp = new Date().toLocaleTimeString();
            const prefix = isError ? '‚ùå' : '‚úÖ';
            statusText.textContent += `[${timestamp}] ${prefix} ${message}\n`;
            statusText.scrollTop = statusText.scrollHeight;
        }

        async function updatePrompts() {
            const newAuthor = document.getElementById('newAuthor').value;
            const addImages = document.getElementById('addImages').checked;

            // Limpiar estado anterior
            document.getElementById('statusText').textContent = '';
            document.getElementById('results').classList.add('hidden');
            document.getElementById('updateBtn').disabled = true;
            document.getElementById('updateBtn').classList.add('opacity-50', 'cursor-not-allowed');

            let updatedCount = 0;

            try {
                log('Cargando prompts desde el servidor...');
                const prompts = await fetch(`${API_URL}/prompts`).then(r => r.json());

                // Filtrar solo prompts de GitHub
                const githubPrompts = prompts.filter(p => p.id.startsWith('github-case-'));
                log(`Encontrados ${githubPrompts.length} prompts importados desde GitHub`);

                if (githubPrompts.length === 0) {
                    log('No hay prompts de GitHub para actualizar', true);
                    return;
                }

                // Actualizar cada prompt
                for (let i = 0; i < githubPrompts.length; i++) {
                    const prompt = githubPrompts[i];

                    // Actualizar autor
                    prompt.author = newAuthor;

                    // Agregar imagen placeholder si no tiene
                    if (addImages && (!prompt.imageUrl || prompt.imageUrl === '')) {
                        // Usar una imagen placeholder de Unsplash relacionada con IA
                        const placeholders = [
                            'https://images.unsplash.com/photo-1677442136019-21780ecad995?w=800',
                            'https://images.unsplash.com/photo-1676277791608-ac54525aa94f?w=800',
                            'https://images.unsplash.com/photo-1675557009875-65e8c6d2f7f7?w=800',
                            'https://images.unsplash.com/photo-1686191128892-3b5e3e4c6c1e?w=800',
                            'https://images.unsplash.com/photo-1655720828018-edd2daec9349?w=800'
                        ];
                        prompt.imageUrl = placeholders[i % placeholders.length];
                    }

                    // Guardar usando PUT (m√©todo seguro)
                    await fetch(`${API_URL}/prompts/${prompt.id}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(prompt)
                    });

                    updatedCount++;

                    if (updatedCount % 10 === 0) {
                        log(`Actualizados ${updatedCount}/${githubPrompts.length} prompts...`);
                    }

                    // Peque√±a pausa
                    await new Promise(resolve => setTimeout(resolve, 50));
                }

                // Mostrar resultados
                document.getElementById('results').classList.remove('hidden');
                document.getElementById('updateCount').textContent = updatedCount;
                log(`\nüéâ Actualizaci√≥n completada: ${updatedCount} prompts actualizados`);
                log(`Autor cambiado a: ${newAuthor}`);
                if (addImages) {
                    log('Im√°genes placeholder agregadas');
                }

            } catch (error) {
                log(`Error: ${error.message}`, true);
                console.error('Error completo:', error);
            } finally {
                document.getElementById('updateBtn').disabled = false;
                document.getElementById('updateBtn').classList.remove('opacity-50', 'cursor-not-allowed');
            }
        }
    </script>
</body>

</html>