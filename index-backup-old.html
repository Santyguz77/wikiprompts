<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="theme-color" content="#FF5E5E" />
    <meta
      http-equiv="Cache-Control"
      content="no-cache, no-store, must-revalidate"
    />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <link rel="manifest" href="/manifest.json" />
    <link rel="icon" type="image/png" href="/image.png" />
    <link rel="apple-touch-icon" href="/image.png" />
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons+Round"
      rel="stylesheet"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              primary: "#FF5E5E",
              accent: "#FF5E5E",
              "background-light": "#FDFBF7",
              "background-dark": "#121412",
            },
            fontFamily: { sans: ["Inter", "sans-serif"] },
            borderRadius: { DEFAULT: "16px" },
          },
        },
      };
    </script>
    <title>Admin - Lazos de Amor</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family: Inter, sans-serif;
        -webkit-tap-highlight-color: transparent;
      }
      body::before {
        content: "";
        position: fixed;
        inset: 0;
        pointer-events: none;
        z-index: 9999;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='320' height='320' viewBox='0 0 320 320'%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' fill='rgba(255,94,94,0.12)' font-family='Inter, sans-serif' font-size='32' transform='rotate(-30 160 160)'%3EVERSION DE PRUEBA%3C/text%3E%3C/svg%3E");
        background-repeat: repeat;
        background-size: 320px 320px;
      }
      .hide-scrollbar::-webkit-scrollbar {
        display: none;
      }
      .hide-scrollbar {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
      .app {
        display: flex;
        min-height: 100vh;
        background: #f8f9f5;
      }
      .sidebar {
        position: fixed;
        left: -280px;
        top: 0;
        width: 260px;
        height: 100vh;
        background: #fff;
        padding: 20px;
        box-shadow: 2px 0 12px rgba(0, 0, 0, 0.1);
        z-index: 1000;
        transition: left 0.3s ease;
        overflow-y: auto;
      }
      .sidebar.mobile-open {
        left: 0;
      }
      .brand {
        text-align: center;
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 1px solid #e2e8f0;
      }
      .brand > div {
        font-size: 20px;
        font-weight: 700;
        color: #ff5e5e;
        margin-bottom: 5px;
      }
      .brand span {
        font-size: 11px;
        color: #ff5e5e;
        text-transform: uppercase;
        letter-spacing: 0.1em;
      }
      .menu {
        list-style: none;
      }
      .menu li {
        padding: 12px 16px;
        margin-bottom: 5px;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.3s;
        color: #64748b;
        font-size: 14px;
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .menu li:hover {
        background: #fee2e2;
        color: #ff5e5e;
      }
      .menu li.active {
        background: #ff5e5e;
        color: #fff;
      }
      .menu-icon {
        font-size: 18px;
      }
      .main {
        flex: 1;
        width: 100%;
        padding: 90px 20px 120px 20px;
        max-width: 1400px;
        margin: 0 auto;
      }
      .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
        flex-wrap: wrap;
        gap: 15px;
      }
      .header h1 {
        font-size: 28px;
        font-weight: 700;
        color: #ff5e5e;
      }
      .btn {
        padding: 10px 20px;
        border: none;
        border-radius: 12px;
        font-weight: 600;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.3s;
        background: #ff5e5e;
        color: #fff;
      }
      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(255, 94, 94, 0.35);
      }
      .btn:active {
        transform: translateY(0);
      }
      .btn-success {
        background: #4caf50;
      }
      .btn-danger {
        background: #f44336;
      }
      .btn-secondary {
        background: #64748b;
      }
      .btn-warning {
        background: #ff9800;
      }
      .btn-small {
        padding: 6px 12px;
        font-size: 12px;
      }
      .card {
        background: #fff;
        padding: 25px;
        border-radius: 24px;
        box-shadow: 0 2px 8px rgba(255, 94, 94, 0.08);
        margin-bottom: 20px;
      }
      .table-scroll {
        overflow-x: auto;
      }
      table {
        width: 100%;
        border-collapse: collapse;
      }
      table th {
        text-align: left;
        padding: 12px;
        background: #f8f9fa;
        font-weight: 600;
        color: #ff5e5e;
        font-size: 13px;
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }
      table td {
        padding: 12px;
        border-bottom: 1px solid #f1f5f9;
      }
      .badge {
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 11px;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }
      .badge-warning {
        background: rgba(255, 152, 0, 0.15);
        color: #ff9800;
      }
      .badge-info {
        background: rgba(33, 150, 243, 0.15);
        color: #2196f3;
      }
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 2000;
        justify-content: center;
        align-items: center;
        padding: 20px;
      }
      .modal.show {
        display: flex;
      }
      .panel {
        background: #fff;
        padding: 30px;
        border-radius: 20px;
        max-width: 600px;
        width: 100%;
        max-height: 90vh;
        overflow-y: auto;
      }
      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }
      .modal-close {
        background: #f1f5f9;
        border: none;
        width: 32px;
        height: 32px;
        border-radius: 50%;
        cursor: pointer;
        font-size: 18px;
        color: #64748b;
      }
      .loading-spinner {
        width: 48px;
        height: 48px;
        border: 4px solid rgba(148, 163, 184, 0.3);
        border-top-color: #ff5e5e;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }
      .form-group {
        margin-bottom: 20px;
      }
      .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #ff5e5e;
        font-size: 14px;
      }
      .form-group input,
      .form-group select,
      .form-group textarea {
        width: 100%;
        padding: 12px;
        border: 2px solid #e2e8f0;
        border-radius: 12px;
        font-size: 14px;
        font-family: Inter, sans-serif;
        transition: border-color 0.3s;
      }
      .form-group input:focus,
      .form-group select:focus,
      .form-group textarea:focus {
        outline: 0;
        border-color: #ff5e5e;
      }
      .form-row {
        display: flex;
        gap: 15px;
      }
      .controls {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }
      .mobile-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(45, 105, 67, 0.7);
        z-index: 999;
      }
      .mobile-overlay.active {
        display: block;
      }
      .sidebar.mobile-open {
        transform: translateX(0) !important;
      }
      @media (max-width: 768px) {
        .main {
          padding: 80px 15px 100px 15px;
        }
        .dashboard-grid {
          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        }
        #dashboard.section.active {
          display: flex;
          flex-direction: column;
        }
        #dashboard .header {
          order: 1;
        }
        #dashboard > div[style*="margin-top"] {
          order: 2;
        }
        #dashboard .dashboard-grid {
          order: 3;
        }
        #dashboard .dashboard-charts-section {
          order: 4;
        }
      }
      .products-table-view {
        display: block;
      }
      .products-cards-view {
        display: none;
      }
      @media (max-width: 768px) {
        .products-table-view {
          display: none;
        }
        .products-cards-view {
          display: grid;
          grid-template-columns: 1fr;
          gap: 16px;
          padding: 0;
        }
      }
      .dashboard-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
        overflow: hidden;
      }
      .stat-card {
        background: #fff;
        padding: 20px;
        border-radius: 24px;
        box-shadow: 0 2px 8px rgba(45, 90, 39, 0.08);
        border: 1px solid rgba(45, 90, 39, 0.08);
        min-width: 0;
        overflow: hidden;
        transition: all 0.3s ease;
      }
      .stat-card:hover {
        box-shadow: 0 4px 16px rgba(45, 90, 39, 0.12);
        transform: translateY(-2px);
      }
      .stat-card h3 {
        font-size: 11px;
        color: #94a3b8;
        text-transform: uppercase;
        margin-bottom: 12px;
        font-weight: 700;
        letter-spacing: 0.1em;
      }
      .stat-card .value {
        font-size: 28px;
        font-weight: 700;
        color: #ff5e5e;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        max-width: 100%;
        margin-bottom: 4px;
      }
      .section {
        display: none;
      }
      .section.active {
        display: block;
      }
      .order-card {
        background: rgba(0, 0, 0, 0.3);
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 15px;
        border-left: 4px solid var(--accent);
      }
      .order-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
      }
      .order-items-list {
        margin: 10px 0;
        padding: 10px;
        background: rgba(0, 0, 0, 0.2);
        border-radius: 6px;
      }
      .order-item-line {
        display: flex;
        justify-content: space-between;
        padding: 5px 0;
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      }
      .close-cash-summary {
        background: linear-gradient(135deg, var(--success), #388e3c);
        color: #fff;
        padding: 30px;
        border-radius: 12px;
        margin-top: 20px;
      }
      .close-cash-summary h2 {
        margin-bottom: 20px;
      }
      .close-cash-line {
        display: flex;
        justify-content: space-between;
        padding: 10px 0;
        border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        font-size: 18px;
      }
      .close-cash-total {
        font-size: 32px;
        font-weight: 700;
        margin-top: 20px;
        text-align: right;
      }
      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
          transform: scale(1);
        }
        50% {
          opacity: 0.5;
          transform: scale(1.2);
        }
      }
      @keyframes slideIn {
        from {
          transform: translateX(400px);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }
      @keyframes slideOut {
        from {
          transform: translateX(0);
          opacity: 1;
        }
        to {
          transform: translateX(400px);
          opacity: 0;
        }
      }
    </style>
  </head>
  <body
    class="bg-background-light text-slate-800 min-h-screen"
    style="font-family: Inter, sans-serif"
  >
    <script>
      const session = localStorage.getItem("userSession");
      if (session) {
        "admin" !== JSON.parse(session).type &&
          (alert(
            "‚ö†Ô∏è Acceso denegado. Esta p√°gina es solo para administradores.",
          ),
          (window.location.href = "/login.html"));
      } else window.location.href = "/login.html";
    </script>
    <header
      class="sticky top-0 z-50 bg-white/80 backdrop-blur-md px-5 py-4 flex items-center justify-between border-b border-slate-200"
    >
      <div class="flex items-center gap-3">
        <div
          class="w-12 h-12 bg-white rounded-full flex items-center justify-center shadow-sm overflow-hidden border border-slate-100"
          style="padding: 3px"
        >
          <img
            alt="Lazos de Amor Logo"
            class="w-full h-full object-cover rounded-full"
            src="image.png"
          />
        </div>
        <div>
          <h1 class="text-lg font-bold text-primary leading-tight">
            Lazos de Amor
          </h1>
          <p
            class="text-[10px] font-medium text-accent uppercase tracking-wider"
          >
            Accesorios y Detalles
          </p>
        </div>
      </div>
      <div class="flex items-center gap-3">
        <div style="position: relative">
          <button
            onclick="toggleNotifications(event)"
            class="w-10 h-10 flex items-center justify-center rounded-full bg-slate-100 text-slate-600 hover:bg-primary hover:text-white transition-all"
            title="Notificaciones"
          >
            <span class="material-icons-round text-xl">notifications</span>
          </button>
          <span
            id="notifications-badge"
            class="hidden absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center"
            style="font-size: 10px"
            >0</span
          >
          <div
            id="notifications-menu"
            class="hidden"
            style="
              position: absolute;
              top: 50px;
              right: 0;
              background: #fff;
              border-radius: 12px;
              box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
              width: 320px;
              max-height: 400px;
              overflow-y: auto;
              z-index: 1000;
            "
          >
            <div
              style="
                padding: 15px;
                border-bottom: 1px solid #e2e8f0;
                display: flex;
                justify-content: space-between;
                align-items: center;
              "
            >
              <div
                style="
                  font-weight: 600;
                  color: #ff5e5e;
                  font-size: 14px;
                  display: flex;
                  align-items: center;
                  gap: 8px;
                "
              >
                <span class="material-icons-round" style="font-size: 18px"
                  >notifications_active</span
                >
                Notificaciones
              </div>
              <button
                onclick="clearAllNotifications()"
                style="
                  color: #94a3b8;
                  font-size: 12px;
                  background: 0 0;
                  border: none;
                  cursor: pointer;
                  text-decoration: underline;
                "
                title="Limpiar todas"
              >
                Limpiar
              </button>
            </div>
            <div id="notifications-list" style="padding: 10px">
              <p
                style="
                  text-align: center;
                  color: #94a3b8;
                  padding: 20px;
                  font-size: 13px;
                "
              >
                No hay notificaciones
              </p>
            </div>
          </div>
        </div>
        <div style="position: relative">
          <button
            onclick="toggleUserMenu(event)"
            class="w-10 h-10 rounded-full bg-primary/10 border-2 border-primary/20 flex items-center justify-center hover:bg-primary/20 transition-colors cursor-pointer"
            title="Men√∫ de Usuario"
          >
            <span class="material-icons-round text-primary"
              >account_circle</span
            >
          </button>
          <div
            id="user-menu"
            class="hidden"
            style="
              position: absolute;
              top: 50px;
              right: 0;
              background: #fff;
              border-radius: 12px;
              box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
              min-width: 200px;
              overflow: hidden;
              z-index: 1000;
            "
          >
            <div style="padding: 15px; border-bottom: 1px solid #e2e8f0">
              <div style="font-weight: 600; color: #ff5e5e; font-size: 14px">
                Administrador
              </div>
              <div style="font-size: 12px; color: #94a3b8">
                Lazos de Amor Admin
              </div>
            </div>
            <button
              onclick="logout()"
              style="
                width: 100%;
                padding: 12px 15px;
                text-align: left;
                border: none;
                background: 0 0;
                cursor: pointer;
                transition: background 0.2s;
                display: flex;
                align-items: center;
                gap: 10px;
                font-size: 14px;
                color: #64748b;
              "
              onmouseover="this.style.background = '#f8f9fa'"
              onmouseout="this.style.background = 'transparent'"
            >
              <span class="material-icons-round" style="font-size: 18px"
                >logout</span
              >
              Cerrar Sesi√≥n
            </button>
          </div>
        </div>
      </div>
    </header>
    <div class="mobile-overlay" onclick="closeMobileMenu()"></div>
    <div class="app">
      <div class="sidebar" id="sidebar">
        <div class="brand">
          <img
            src="image.png"
            alt="Logo"
            style="
              width: 60px;
              height: 60px;
              border-radius: 50%;
              margin-bottom: 10px;
            "
          />
          <div>Lazos de Amor</div>
          <span>Accesorios y Detalles</span>
        </div>
        <ul class="menu">
          <li
            class="active"
            onclick="(showSection('dashboard'), closeMobileMenu())"
          >
            <span class="menu-icon">üìä</span> Dashboard
          </li>
          <li onclick="(showSection('orders'), closeMobileMenu())">
            <span class="menu-icon">üìù</span> Pedidos
          </li>
          <li onclick="(showSection('menu-config'), closeMobileMenu())">
            <span class="menu-icon">üëó</span> Cat√°logo
          </li>
          <li onclick="(showSection('transactions'), closeMobileMenu())">
            <span class="menu-icon">üí∞</span> Finanzas
          </li>
          <li onclick="(showSection('close-cash'), closeMobileMenu())">
            <span class="menu-icon">üîí</span> Cierre de Caja
          </li>
          <li onclick="(showSection('system-config'), closeMobileMenu())">
            <span class="menu-icon">‚öôÔ∏è</span> Configuraci√≥n
          </li>
          <li
            onclick="logout()"
            style="
              margin-top: 20px;
              border-top: 1px solid rgba(255, 107, 53, 0.2);
              padding-top: 15px;
            "
          >
            <span class="menu-icon">üö™</span> Cerrar Sesi√≥n
          </li>
        </ul>
      </div>
      <div class="main">
        <div id="dashboard" class="section active">
          <div class="header">
            <h1>Dashboard</h1>
            <div style="display: flex; align-items: center; gap: 15px">
              <span
                style="
                  color: #4caf50;
                  font-size: 14px;
                  display: flex;
                  align-items: center;
                  gap: 5px;
                "
                ><span
                  style="
                    width: 8px;
                    height: 8px;
                    background: #4caf50;
                    border-radius: 50%;
                    animation: pulse 2s infinite;
                  "
                ></span>
                Auto-actualizaci√≥n activa</span
              >
            </div>
          </div>
          <div class="dashboard-grid">
            <div class="stat-card">
              <div class="flex items-center gap-2 mb-3">
                <span class="material-icons-round text-orange-400 text-lg"
                  >payments</span
                >
                <h3 style="margin: 0">Ventas Hoy</h3>
              </div>
              <div class="value" id="stat-sales">$0</div>
              <small
                style="color: #94a3b8; font-size: 13px"
                id="stat-sales-count"
                >0 pedidos</small
              >
            </div>
            <div class="stat-card">
              <div class="flex items-center gap-2 mb-3">
                <span class="material-icons-round text-blue-400 text-lg"
                  >calendar_month</span
                >
                <h3 style="margin: 0">Total Mes</h3>
              </div>
              <div class="value" id="stat-month">$0</div>
              <small
                style="color: #94a3b8; font-size: 13px"
                id="stat-month-count"
                >0 pedidos</small
              >
            </div>
            <div class="stat-card">
              <div class="flex items-center gap-2 mb-3">
                <span class="material-icons-round text-purple-400 text-lg"
                  >receipt_long</span
                >
                <h3 style="margin: 0">Ticket Prom.</h3>
              </div>
              <div class="value" id="stat-avg-ticket">$0</div>
              <small style="color: #94a3b8; font-size: 13px">Por pedido</small>
            </div>
            <div class="stat-card">
              <div class="flex items-center gap-2 mb-3">
                <span class="material-icons-round text-emerald-400 text-lg"
                  >shopping_bag</span
                >
                <h3 style="margin: 0">Activos</h3>
              </div>
              <div class="value" id="stat-orders">0</div>
              <small style="color: #94a3b8; font-size: 13px" id="stat-products"
                >0 productos</small
              >
            </div>
          </div>
          <div class="dashboard-grid" style="margin-top: 20px">
            <div class="stat-card">
              <div class="flex items-center gap-2 mb-3">
                <span class="material-icons-round text-indigo-400 text-lg"
                  >event</span
                >
                <h3 style="margin: 0">Total A√±o</h3>
              </div>
              <div class="value" id="stat-year">$0</div>
              <small
                style="color: #94a3b8; font-size: 13px"
                id="stat-year-count"
                >0 pedidos</small
              >
            </div>
            <div class="stat-card">
              <div class="flex items-center gap-2 mb-3">
                <span class="material-icons-round text-green-400 text-lg"
                  >trending_up</span
                >
                <h3 style="margin: 0">Crecimiento</h3>
              </div>
              <div class="value" id="stat-growth">0%</div>
              <small style="color: #94a3b8; font-size: 13px"
                >vs mes anterior</small
              >
            </div>
            <div class="stat-card">
              <div class="flex items-center gap-2 mb-3">
                <span class="material-icons-round text-red-400 text-lg"
                  >local_fire_department</span
                >
                <h3 style="margin: 0">Mejor D√≠a</h3>
              </div>
              <div class="value" id="stat-best-day" style="font-size: 18px">
                -
              </div>
              <small
                style="color: #94a3b8; font-size: 13px"
                id="stat-best-day-amount"
                >$0</small
              >
            </div>
            <div class="stat-card">
              <div class="flex items-center gap-2 mb-3">
                <span class="material-icons-round text-amber-400 text-lg"
                  >schedule</span
                >
                <h3 style="margin: 0">Hora Pico</h3>
              </div>
              <div class="value" id="stat-peak-hour">-</div>
              <small
                style="color: #94a3b8; font-size: 13px"
                id="stat-peak-hour-orders"
                >0 pedidos</small
              >
            </div>
          </div>
          <div
            style="
              margin-top: 20px;
              background: #fff;
              padding: 25px;
              border-radius: 24px;
              box-shadow: 0 2px 8px rgba(45, 90, 39, 0.08);
            "
          >
            <div class="flex items-center justify-between mb-4">
              <div class="flex items-center gap-2">
                <span class="material-icons-round text-accent">bolt</span>
                <h3
                  style="
                    font-size: 18px;
                    font-weight: 700;
                    color: #ff5e5e;
                    margin: 0;
                  "
                >
                  Pedidos en Tiempo Real
                </h3>
              </div>
              <div class="flex gap-2">
                <button
                  onclick="scrollOrdersLeft()"
                  class="w-10 h-10 flex items-center justify-center rounded-full bg-slate-100 hover:bg-primary hover:text-white transition-all"
                  style="border: none; cursor: pointer"
                >
                  <span class="material-icons-round">chevron_left</span>
                </button>
                <button
                  onclick="scrollOrdersRight()"
                  class="w-10 h-10 flex items-center justify-center rounded-full bg-slate-100 hover:bg-primary hover:text-white transition-all"
                  style="border: none; cursor: pointer"
                >
                  <span class="material-icons-round">chevron_right</span>
                </button>
              </div>
            </div>
            <div id="dashboard-orders-realtime"></div>
          </div>
          <div class="dashboard-charts-section">
            <div
              class="charts-grid"
              style="
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
                gap: 20px;
                margin-bottom: 20px;
                margin-top: 20px;
                overflow: hidden;
              "
            >
              <div
                style="
                  background: #fff;
                  padding: 25px;
                  border-radius: 24px;
                  box-shadow: 0 2px 8px rgba(255, 94, 94, 0.08);
                "
              >
                <h3
                  style="
                    margin-bottom: 20px;
                    font-size: 16px;
                    font-weight: 700;
                    color: #ff5e5e;
                    display: flex;
                    align-items: center;
                    gap: 8px;
                  "
                >
                  <span class="material-icons-round text-lg">trending_up</span>
                  Ventas √öltimos 7 D√≠as
                </h3>
                <canvas
                  id="sales-chart"
                  style="max-height: 250px; max-width: 100%"
                ></canvas>
              </div>
              <div
                style="
                  background: #fff;
                  padding: 25px;
                  border-radius: 24px;
                  box-shadow: 0 2px 8px rgba(255, 94, 94, 0.08);
                "
              >
                <h3
                  style="
                    margin-bottom: 20px;
                    font-size: 16px;
                    font-weight: 700;
                    color: #ff5e5e;
                    display: flex;
                    align-items: center;
                    gap: 8px;
                  "
                >
                  <span class="material-icons-round text-lg">emoji_events</span>
                  Productos M√°s Vendidos
                </h3>
                <canvas
                  id="products-chart"
                  style="max-height: 250px; max-width: 100%"
                ></canvas>
              </div>
              <div
                style="
                  background: #fff;
                  padding: 25px;
                  border-radius: 24px;
                  box-shadow: 0 2px 8px rgba(255, 94, 94, 0.08);
                "
              >
                <h3
                  style="
                    margin-bottom: 20px;
                    font-size: 16px;
                    font-weight: 700;
                    color: #ff5e5e;
                    display: flex;
                    align-items: center;
                    gap: 8px;
                  "
                >
                  <span class="material-icons-round text-lg">bar_chart</span>
                  Evoluci√≥n Mensual
                </h3>
                <canvas
                  id="monthly-chart"
                  style="max-height: 250px; max-width: 100%"
                ></canvas>
              </div>
              <div
                style="
                  background: #fff;
                  padding: 25px;
                  border-radius: 24px;
                  box-shadow: 0 2px 8px rgba(255, 94, 94, 0.08);
                "
              >
                <h3
                  style="
                    margin-bottom: 20px;
                    font-size: 16px;
                    font-weight: 700;
                    color: #ff5e5e;
                    display: flex;
                    align-items: center;
                    gap: 8px;
                  "
                >
                  <span class="material-icons-round text-lg">category</span>
                  Categor√≠as M√°s Vendidas
                </h3>
                <canvas
                  id="category-chart"
                  style="max-height: 250px; max-width: 100%"
                ></canvas>
              </div>
            </div>
          </div>
        </div>
        <div id="orders" class="section">
          <div class="header">
            <h1>Pedidos Activos</h1>
            <div class="controls">
              <button class="btn btn-success" onclick="refreshData()">
                üîÑ Actualizar
              </button>
            </div>
          </div>
          <div class="card" id="orders-list"></div>
        </div>
        <div id="menu-config" class="section">
          <div style="margin-bottom: 24px">
            <div
              style="
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 8px;
                flex-wrap: wrap;
                gap: 12px;
              "
            >
              <div>
                <h1
                  style="
                    font-size: 28px;
                    font-weight: 700;
                    color: #ff5e5e;
                    margin: 0 0 4px 0;
                  "
                >
                  Cat√°logo de Productos
                </h1>
                <p style="color: #64748b; font-size: 14px; margin: 0">
                  Gestiona tu inventario y productos disponibles
                </p>
              </div>
              <button
                onclick="openMenuItemModal()"
                style="
                  background: linear-gradient(135deg, #ff5e5e 0, #e04f4f 100%);
                  color: #fff;
                  border: none;
                  padding: 12px 24px;
                  border-radius: 12px;
                  font-weight: 600;
                  font-size: 14px;
                  cursor: pointer;
                  display: flex;
                  align-items: center;
                  gap: 8px;
                  box-shadow: 0 4px 12px rgba(255, 94, 94, 0.3);
                  transition: all 0.3s;
                "
                onmouseover="this.style.transform = 'translateY(-2px)'"
                onmouseout="this.style.transform = 'translateY(0)'"
              >
                <span class="material-icons-round">add_circle</span> Nuevo
                Producto
              </button>
            </div>
          </div>
          <div
            style="
              background: #fff;
              padding: 20px;
              border-radius: 16px;
              margin-bottom: 20px;
              box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
              border: 1px solid #e2e8f0;
            "
          >
            <div
              style="
                display: flex;
                gap: 12px;
                flex-wrap: wrap;
                align-items: center;
              "
            >
              <div style="flex: 1; min-width: 250px">
                <div style="position: relative">
                  <span
                    class="material-icons-round"
                    style="
                      position: absolute;
                      left: 12px;
                      top: 50%;
                      transform: translateY(-50%);
                      color: #94a3b8;
                      font-size: 20px;
                    "
                    >search</span
                  >
                  <input
                    type="text"
                    id="products-search"
                    placeholder="Buscar productos..."
                    onkeyup="filterProducts()"
                    style="
                      width: 100%;
                      padding: 12px 12px 12px 42px;
                      border: 2px solid #e2e8f0;
                      border-radius: 12px;
                      font-size: 14px;
                      transition: all 0.3s;
                      background: #f8f9fa;
                    "
                    onfocus="
                      ((this.style.borderColor = '#FF5E5E'),
                        (this.style.background = 'white'))
                    "
                    onblur="
                      ((this.style.borderColor = '#e2e8f0'),
                        (this.style.background = '#f8f9fa'))
                    "
                  />
                </div>
              </div>
              <select
                id="products-category-filter"
                onchange="filterProducts()"
                style="
                  padding: 12px 16px;
                  border: 2px solid #e2e8f0;
                  border-radius: 12px;
                  font-size: 14px;
                  cursor: pointer;
                  background: #fff;
                  color: #334155;
                  font-weight: 500;
                "
              >
                <option value="all">Todas las categor√≠as</option>
                <option value="Jeans">Jeans</option>
                <option value="Camisas">Camisas</option>
                <option value="Chaquetas">Chaquetas</option>
                <option value="Accesorios">Accesorios</option>
                <option value="Calzado">Calzado</option>
              </select>
              <select
                id="products-availability-filter"
                onchange="filterProducts()"
                style="
                  padding: 12px 16px;
                  border: 2px solid #e2e8f0;
                  border-radius: 12px;
                  font-size: 14px;
                  cursor: pointer;
                  background: #fff;
                  color: #334155;
                  font-weight: 500;
                "
              >
                <option value="all">Todos los productos</option>
                <option value="visible">Visibles en cat√°logo</option>
                <option value="hidden">Ocultos</option>
              </select>
            </div>
          </div>
          <div class="products-table-view">
            <div class="card">
              <div class="table-scroll">
                <table id="menu-table">
                  <thead>
                    <tr>
                      <th>Nombre</th>
                      <th>Descripci√≥n</th>
                      <th>Categor√≠a</th>
                      <th>Costo</th>
                      <th>Precio</th>
                      <th>Ganancia</th>
                      <th>Margen</th>
                      <th>Visible en Cat√°logo</th>
                      <th>Acciones</th>
                    </tr>
                  </thead>
                  <tbody></tbody>
                </table>
              </div>
            </div>
          </div>
          <div class="products-cards-view" id="products-cards-container"></div>
        </div>
        <div id="transactions" class="section">
          <div class="header"><h1>Historial de Transacciones</h1></div>
          <div class="card">
            <div class="table-scroll">
              <table id="transactions-table">
                <thead>
                  <tr>
                    <th>Fecha</th>
                    <th>Cliente</th>
                    <th>Concepto</th>
                    <th>Monto</th>
                    <th>Acciones</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
        </div>
        <div id="close-cash" class="section">
          <div class="header">
            <h1>Cierre de Caja</h1>
            <div class="controls">
              <button class="btn btn-warning" onclick="generateCloseCash()">
                üìÑ Generar Cierre Actual
              </button>
              <button class="btn btn-secondary" onclick="viewClosureHistory()">
                üìã Historial
              </button>
            </div>
          </div>
          <div class="card">
            <div id="close-cash-content">
              <p class="text-center" style="color: var(--muted); padding: 40px">
                Haz clic en "Generar Cierre Actual" para ver el resumen del d√≠a
              </p>
            </div>
          </div>
          <div id="closure-history" style="margin-top: 20px; display: none">
            <h3 style="color: var(--accent); margin-bottom: 15px">
              Historial de Cierres
            </h3>
            <div class="table-scroll">
              <table id="closures-table">
                <thead>
                  <tr>
                    <th>Fecha</th>
                    <th>Transacciones</th>
                    <th>Total</th>
                    <th>Acciones</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
        </div>
        <div id="system-config" class="section">
          <div class="header"><h1>Configuraci√≥n del Sistema</h1></div>
          <div class="card" style="margin-bottom: 20px">
            <h3 style="color: var(--accent); margin-bottom: 15px">
              üîî Notificaciones
            </h3>
            <p style="color: var(--muted); margin-bottom: 20px">
              Configura las alertas de nuevos pedidos en tu dispositivo m√≥vil o
              computadora.
            </p>
            <div
              style="
                background: var(--panel);
                border: 2px solid var(--accent);
                padding: 20px;
                border-radius: 8px;
                margin-bottom: 15px;
              "
            >
              <div
                style="
                  display: flex;
                  align-items: center;
                  gap: 15px;
                  margin-bottom: 15px;
                "
              >
                <span style="font-size: 40px">üì±</span>
                <div style="flex: 1">
                  <h4 style="color: var(--accent); margin-bottom: 5px">
                    Notificaciones Push del Sistema
                  </h4>
                  <p style="color: var(--muted); font-size: 14px; margin: 0">
                    Recibe alertas como las de WhatsApp o YouTube directamente
                    en tu dispositivo, incluso cuando la app est√© en segundo
                    plano.
                  </p>
                </div>
              </div>
              <div
                id="notification-status"
                style="
                  padding: 10px;
                  border-radius: 8px;
                  margin-bottom: 15px;
                  font-size: 14px;
                "
              ></div>
              <button
                class="btn"
                onclick="enableNotifications()"
                id="enable-notifications-btn"
                style="width: 100%"
              >
                üîî Activar Notificaciones
              </button>
            </div>
          </div>
          <div class="card" style="margin-bottom: 20px">
            <h3 style="color: #f44; margin-bottom: 15px">‚ö†Ô∏è Zona de Peligro</h3>
            <p style="color: var(--muted); margin-bottom: 20px">
              Estas acciones son <strong>irreversibles</strong>. √ösalas con
              precauci√≥n.
            </p>
            <div
              style="
                background: rgba(255, 68, 68, 0.1);
                border: 2px solid #f44;
                padding: 20px;
                border-radius: 8px;
              "
            >
              <h4 style="color: #f44; margin-bottom: 10px">
                üóëÔ∏è Limpiar Datos de Ventas
              </h4>
              <p
                style="
                  color: var(--muted);
                  margin-bottom: 15px;
                  font-size: 14px;
                "
              >
                Elimina todas las √≥rdenes, transacciones y cierres de caja.
                <strong>NO elimina</strong> productos del cat√°logo. √ötil para
                entregar la aplicaci√≥n como nueva o resetear datos de prueba.
              </p>
              <ul
                style="
                  color: var(--muted);
                  margin: 15px 0;
                  padding-left: 25px;
                  font-size: 14px;
                "
              >
                <li>
                  ‚úì Se eliminar√°n todos los pedidos (completados, pendientes,
                  cancelados)
                </li>
                <li>‚úì Se eliminar√°n todas las transacciones</li>
                <li>‚úì Se eliminar√°n todos los cierres de caja</li>
                <li>‚úó Los productos del cat√°logo se mantendr√°n</li>
                <li>‚úó Las facturas guardadas se eliminar√°n</li>
              </ul>
              <button
                class="btn"
                style="background: #f44; border: none"
                onclick="resetSalesData()"
              >
                üóëÔ∏è Limpiar Todos los Datos de Ventas
              </button>
            </div>
          </div>
          <div class="card">
            <h3 style="margin-bottom: 15px">‚ÑπÔ∏è Informaci√≥n del Sistema</h3>
            <div
              style="
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 15px;
              "
            >
              <div
                style="
                  background: var(--panel);
                  padding: 15px;
                  border-radius: 8px;
                "
              >
                <div style="color: var(--muted); font-size: 13px">
                  Productos en Cat√°logo
                </div>
                <div
                  style="
                    color: var(--accent);
                    font-size: 24px;
                    font-weight: 700;
                  "
                  id="info-menu-items"
                >
                  0
                </div>
              </div>
              <div
                style="
                  background: var(--panel);
                  padding: 15px;
                  border-radius: 8px;
                "
              >
                <div style="color: var(--muted); font-size: 13px">
                  Pedidos Totales
                </div>
                <div
                  style="
                    color: var(--accent);
                    font-size: 24px;
                    font-weight: 700;
                  "
                  id="info-orders"
                >
                  0
                </div>
              </div>
              <div
                style="
                  background: var(--panel);
                  padding: 15px;
                  border-radius: 8px;
                "
              >
                <div style="color: var(--muted); font-size: 13px">
                  Clientes Atendidos
                </div>
                <div
                  style="
                    color: var(--accent);
                    font-size: 24px;
                    font-weight: 700;
                  "
                  id="info-customers"
                >
                  0
                </div>
              </div>
              <div
                style="
                  background: var(--panel);
                  padding: 15px;
                  border-radius: 8px;
                "
              >
                <div style="color: var(--muted); font-size: 13px">
                  Facturas Guardadas
                </div>
                <div
                  style="
                    color: var(--accent);
                    font-size: 24px;
                    font-weight: 700;
                  "
                  id="info-invoices"
                >
                  0
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <nav
      class="fixed bottom-0 left-0 right-0 bg-white/90 backdrop-blur-xl border-t border-slate-200 py-2 pb-safe z-50"
      style="box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05)"
    >
      <div class="flex justify-around items-center max-w-xl mx-auto px-4">
        <button
          onclick="(showSection('dashboard'), closeMobileMenu())"
          class="flex flex-col items-center gap-1 text-primary py-2"
        >
          <span class="material-icons-round">dashboard</span>
          <span class="text-[10px] font-medium">Dashboard</span>
        </button>
        <button
          onclick="(showSection('orders'), closeMobileMenu())"
          class="flex flex-col items-center gap-1 text-slate-400 py-2"
        >
          <span class="material-icons-round">receipt</span>
          <span class="text-[10px] font-medium">Pedidos</span>
        </button>
        <button
          onclick="(showSection('menu-config'), closeMobileMenu())"
          class="flex flex-col items-center gap-1 text-slate-400 py-2"
        >
          <span class="material-icons-round">inventory_2</span>
          <span class="text-[10px] font-medium">Cat√°logo</span>
        </button>
        <button
          onclick="(showSection('transactions'), closeMobileMenu())"
          class="flex flex-col items-center gap-1 text-slate-400 py-2"
        >
          <span class="material-icons-round">insights</span>
          <span class="text-[10px] font-medium">Finanzas</span>
        </button>
        <button
          onclick="(showSection('system-config'), closeMobileMenu())"
          class="flex flex-col items-center gap-1 text-slate-400 py-2"
        >
          <span class="material-icons-round">settings</span>
          <span class="text-[10px] font-medium">Config</span>
        </button>
      </div>
    </nav>
    <div id="menu-item-modal" class="modal">
      <div class="panel">
        <div class="modal-header">
          <h3 id="menu-item-modal-title">Nuevo Producto</h3>
          <button class="modal-close" onclick="closeMenuItemModal()">‚úï</button>
        </div>
        <div class="form-group">
          <label>Nombre</label>
          <input
            type="text"
            id="item-name"
            placeholder="Ej: Bolso d	e Macram√© Rosa"
          />
        </div>
        <div class="form-group">
          <label>Descripci√≥n</label>
          <textarea
            id="item-description"
            placeholder="Descripci√≥n del producto"
          ></textarea>
        </div>
        <div class="form-group">
          <label>Categor√≠a</label>
          <input
            type="text"
            id="item-category"
            list="categories-list"
            placeholder="Ej: Bolsos"
            autocomplete="off"
          /><datalist id="categories-list"></datalist
          ><small style="color: var(--muted); display: block; margin-top: 4px"
            >Selecciona una categor√≠a existente o escribe una nueva</small
          >
        </div>
        <div class="form-row">
          <div class="form-group" style="flex: 1">
            <label>Costo de Producci√≥n</label>
            <input
              type="number"
              id="item-cost"
              placeholder="0.00"
              step="0.01"
              oninput="updateProfitPreview()"
            />
            <small style="color: var(--muted); display: block; margin-top: 4px"
              >¬øCu√°nto te cuesta producirlo?</small
            >
          </div>
          <div class="form-group" style="flex: 1">
            <label>Precio de Venta</label>
            <input
              type="number"
              id="item-price"
              placeholder="0.00"
              step="0.01"
              oninput="updateProfitPreview()"
            />
            <small style="color: var(--muted); display: block; margin-top: 4px"
              >¬øA cu√°nto lo vendes?</small
            >
          </div>
        </div>
        <div
          id="profit-preview"
          style="
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            display: none;
          "
        >
          <div
            style="
              display: flex;
              justify-content: space-between;
              margin-bottom: 8px;
            "
          >
            <span>Ganancia por unidad:</span>
            <strong id="profit-amount" style="color: var(--accent)"
              >$0.00</strong
            >
          </div>
          <div style="display: flex; justify-content: space-between">
            <span>Margen de ganancia:</span>
            <strong id="profit-margin" style="color: var(--accent)">0%</strong>
          </div>
        </div>
        <div class="form-group">
          <label>Im√°genes del Producto (hasta 3)</label>
          <input
            type="file"
            id="item-image-file"
            accept="image/*"
            multiple="multiple"
            onchange="handleMultipleImageUpload(this)"
            style="width: 100%"
          />
          <small style="color: var(--muted); display: block; margin-top: 4px"
            >Puedes subir hasta 3 im√°genes. La primera ser√° la imagen
            principal</small
          >
          <div
            id="item-images-preview"
            style="margin-top: 10px; display: flex; gap: 10px; flex-wrap: wrap"
          ></div>
          <input type="hidden" id="item-images" value="[]" />
        </div>
        <div class="form-group">
          <label
            ><input type="checkbox" id="item-available" checked="checked" />
            Disponible</label
          >
        </div>
        <div class="controls">
          <button class="btn" onclick="saveMenuItem()">üíæ Guardar</button>
          <button class="btn btn-secondary" onclick="closeMenuItemModal()">
            Cancelar
          </button>
        </div>
      </div>
    </div>
    <div id="table-detail-modal" class="modal">
      <div class="panel">
        <div class="modal-header">
          <h3 id="table-detail-title">Detalle Mesa</h3>
          <button class="modal-close" onclick="closeTableDetailModal()">
            ‚úï
          </button>
        </div>
        <div id="table-detail-content"></div>
      </div>
    </div>
    <div id="notification-permission-modal" class="modal">
      <div
        class="panel"
        style="max-width: 460px; border-radius: 20px; overflow: hidden"
      >
        <div style="text-align: center; padding: 40px 32px 32px">
          <div
            style="
              width: 90px;
              height: 90px;
              background: linear-gradient(135deg, #fef3c7 0, #fde68a 100%);
              border-radius: 50%;
              display: flex;
              align-items: center;
              justify-content: center;
              margin: 0 auto 24px;
              box-shadow: 0 8px 24px rgba(217, 119, 6, 0.2);
            "
          >
            <span
              class="material-icons-round"
              style="font-size: 52px; color: #d97706"
              >notifications_active</span
            >
          </div>
          <h3
            style="
              margin: 0 0 12px 0;
              color: #ff5e5e;
              font-size: 24px;
              font-weight: 700;
            "
          >
            ¬øActivar Notificaciones?
          </h3>
          <p
            style="margin: 0; color: #64748b; font-size: 15px; line-height: 1.6"
          >
            Recibe alertas instant√°neas de nuevos pedidos en tu dispositivo,
            incluso cuando la app est√© en segundo plano.
          </p>
        </div>
        <div
          style="
            background: #f8f9fa;
            padding: 24px;
            margin: 0 24px 24px;
            border-radius: 12px;
          "
        >
          <div
            style="
              display: flex;
              align-items: start;
              gap: 12px;
              margin-bottom: 16px;
            "
          >
            <span
              class="material-icons-round"
              style="color: #ff5e5e; font-size: 22px"
              >check_circle</span
            >
            <div style="flex: 1">
              <div
                style="
                  font-weight: 600;
                  color: #334155;
                  font-size: 14px;
                  margin-bottom: 4px;
                "
              >
                Alertas en tiempo real
              </div>
              <div style="font-size: 13px; color: #64748b">
                Nunca te pierdas un nuevo pedido
              </div>
            </div>
          </div>
          <div style="display: flex; align-items: start; gap: 12px">
            <span
              class="material-icons-round"
              style="color: #ff5e5e; font-size: 22px"
              >phonelink</span
            >
            <div style="flex: 1">
              <div
                style="
                  font-weight: 600;
                  color: #334155;
                  font-size: 14px;
                  margin-bottom: 4px;
                "
              >
                Funciona en segundo plano
              </div>
              <div style="font-size: 13px; color: #64748b">
                Incluso con la app minimizada
              </div>
            </div>
          </div>
        </div>
        <div style="display: flex; gap: 12px; padding: 0 24px 32px">
          <button
            onclick="closeNotificationModal()"
            class="btn btn-secondary"
            style="flex: 1; font-size: 15px; padding: 14px"
          >
            Ahora no
          </button>
          <button
            onclick="acceptNotifications()"
            class="btn"
            style="
              flex: 1;
              background: linear-gradient(135deg, #ff5e5e 0, #e04f4f 100%);
              font-size: 15px;
              padding: 14px;
              display: flex;
              align-items: center;
              justify-content: center;
              gap: 8px;
              box-shadow: 0 4px 12px rgba(255, 94, 94, 0.3);
            "
          >
            <span class="material-icons-round" style="font-size: 18px"
              >notifications</span
            >
            Activar
          </button>
        </div>
      </div>
    </div>
    <div id="logout-modal" class="modal">
      <div class="panel" style="max-width: 400px">
        <div class="modal-header">
          <h3
            style="
              color: #ff5e5e;
              display: flex;
              align-items: center;
              gap: 10px;
            "
          >
            <span class="material-icons-round" style="color: #ff9800"
              >logout</span
            >
            ¬øCerrar Sesi√≥n?
          </h3>
          <button class="modal-close" onclick="closeLogoutModal()">‚úï</button>
        </div>
        <div style="padding: 20px 0">
          <p style="color: #64748b; margin-bottom: 20px">
            Est√°s a punto de cerrar sesi√≥n. ¬øDeseas continuar?
          </p>
          <div style="display: flex; gap: 10px; justify-content: flex-end">
            <button class="btn btn-secondary" onclick="closeLogoutModal()">
              Cancelar
            </button>
            <button
              class="btn"
              style="background: #f44336"
              onclick="confirmLogout()"
            >
              Cerrar Sesi√≥n
            </button>
          </div>
        </div>
      </div>
    </div>
    <div id="order-modal" class="modal">
      <div class="panel" style="max-width: 1200px">
        <div class="modal-header">
          <h3 id="order-modal-title">Nuevo Pedido</h3>
          <button class="modal-close" onclick="closeOrderModal()">‚úï</button>
        </div>
        <div style="display: grid; grid-template-columns: 1fr 400px; gap: 20px">
          <div style="max-height: 500px; overflow-y: auto; padding-right: 10px">
            <h4 style="color: var(--accent); margin-bottom: 15px">
              üçî Seleccionar Productos
            </h4>
            <div id="order-menu-items"></div>
          </div>
          <div
            style="
              background: rgba(255, 255, 255, 0.03);
              padding: 20px;
              border-radius: 12px;
              border: 2px solid rgba(255, 255, 255, 0.1);
            "
          >
            <h4 style="color: var(--accent); margin-bottom: 15px">
              üìù Pedido Actual
            </h4>
            <div
              id="order-items-summary"
              style="max-height: 300px; overflow-y: auto; margin-bottom: 15px"
            ></div>
            <div
              style="
                background: linear-gradient(135deg, #fff, #e0e0e0);
                padding: 15px;
                border-radius: 8px;
                margin-bottom: 15px;
              "
            >
              <div
                style="
                  font-size: 14px;
                  color: #000;
                  margin-bottom: 5px;
                  font-weight: 600;
                "
              >
                Total a Pagar
              </div>
              <div
                id="order-total-amount"
                style="font-size: 32px; font-weight: 700; color: #000"
              >
                $0.00
              </div>
            </div>
            <div style="display: flex; flex-direction: column; gap: 10px">
              <button
                class="btn"
                onclick="saveOrderFromModal()"
                style="width: 100%"
              >
                üíæ Guardar Pedido
              </button>
              <button
                class="btn btn-secondary"
                onclick="closeOrderModal()"
                style="width: 100%"
              >
                Cancelar
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div id="operation-status-modal" class="modal">
      <div
        class="panel"
        style="max-width: 360px; text-align: center; padding: 32px 28px"
      >
        <div
          id="operation-status-loading"
          style="
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 16px;
          "
        >
          <div class="loading-spinner"></div>
          <p
            id="operation-status-message"
            style="margin: 0; color: #64748b; font-weight: 600"
          >
            Procesando...
          </p>
        </div>
        <div
          id="operation-status-error"
          style="
            display: none;
            flex-direction: column;
            align-items: center;
            gap: 16px;
          "
        >
          <span
            class="material-icons-round"
            style="font-size: 46px; color: #ef4444"
            >error_outline</span
          >
          <p
            id="operation-status-error-message"
            style="margin: 0; color: #1e293b; line-height: 1.5"
          ></p>
          <button
            class="btn btn-secondary"
            onclick="closeOperationStatusModal()"
            style="width: 100%; font-weight: 600"
          >
            Entendido
          </button>
        </div>
      </div>
    </div>
    <script src="app.js"></script>
    <script>
      let currentEditingTable = null,
        currentEditingMenuItem = null,
        autoRefreshInterval = null,
        isRefreshing = !1,
        lastKnownOrderIds = new Set(),
        notificationSound = null;
      async function init() {
        (await loadInitialData(),
          await initializeDefaultData(),
          AppState.orders.forEach((t) => lastKnownOrderIds.add(t.id)),
          renderDashboard(),
          renderAllSections(),
          startAutoRefresh(),
          updateNotificationStatus());
      }
      function startAutoRefresh() {
        (autoRefreshInterval && clearInterval(autoRefreshInterval),
          (autoRefreshInterval = setInterval(async () => {
            if (!isRefreshing) {
              isRefreshing = !0;
              try {
                AppState.orders.length;
                (await loadInitialData(), checkForNewOrders());
                const t = document.querySelector(".section.active");
                if (t) {
                  const e = t.id;
                  ("dashboard" === e && renderDashboard(),
                    "orders" === e && renderOrders(),
                    "transactions" === e && renderTransactions());
                }
                updateNotificationBadge();
              } catch (t) {
                console.error("Error en auto-refresh:", t);
              } finally {
                isRefreshing = !1;
              }
            }
          }, 5e3)));
      }
      function stopAutoRefresh() {
        autoRefreshInterval &&
          (clearInterval(autoRefreshInterval), (autoRefreshInterval = null));
      }
      function updateNotificationBadge() {
        const t = AppState.orders.filter((t) => "pending" === t.status).length;
        document.title =
          t > 0 ? `(${t}) Admin - Lazos de Amor` : "Admin - Lazos de Amor";
      }
      function checkForNewOrders() {
        new Set(AppState.orders.map((t) => t.id));
        (AppState.orders.forEach((t) => {
          lastKnownOrderIds.has(t.id) ||
            (showNewOrderNotification(t), lastKnownOrderIds.add(t.id));
        }),
          lastKnownOrderIds.size > 100 &&
            (lastKnownOrderIds = new Set(AppState.orders.map((t) => t.id))));
      }
      function showNewOrderNotification(t) {
        playNotificationSound();
        const e =
          t.customerData && t.customerData.name
            ? t.customerData.name
            : "Cat√°logo Virtual";
        addNotification(
          "order",
          "¬°Nuevo Pedido!",
          `Cliente: ${e} - Total: ${Utils.formatCurrency(t.total)}`,
          t.id,
        );
        const n = document.createElement("div");
        ((n.style.cssText =
          "\n\t\t\t\tposition: fixed;\n\t\t\t\ttop: 80px;\n\t\t\t\tright: 30px;\n\t\t\t\tbackground: linear-gradient(135deg, #FF5E5E 0%, #E04F4F 100%);\n\t\t\t\tcolor: #fff;\n\t\t\t\tpadding: 20px 30px;\n\t\t\t\tborder-radius: 12px;\n\t\t\t\tbox-shadow: 0 8px 30px rgba(45, 105, 67, 0.5);\n\t\t\t\tz-index: 10000;\n\t\t\t\tfont-size: 16px;\n\t\t\t\tfont-weight: 600;\n\t\t\t\tanimation: slideInRight 0.5s ease;\n\t\t\t\tmin-width: 320px;\n\t\t\t\tmax-width: 400px;\n\t\t\t\tcursor: pointer;\n\t\t\t"),
          (n.innerHTML = `\n\t\t\t\t<div style="display: flex; align-items: center; gap: 15px;">\n\t\t\t\t\t<span style="font-size: 40px;">üõçÔ∏è</span>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div style="font-size: 18px; margin-bottom: 5px;">¬°Nuevo Pedido!</div>\n\t\t\t\t\t\t<div style="font-size: 14px; opacity: 0.9;">Cliente: ${e}</div>\n\t\t\t\t\t\t<div style="font-size: 13px; opacity: 0.8; margin-top: 3px;">Total: ${Utils.formatCurrency(t.total)}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`),
          (n.onclick = () => {
            (showSection("orders"), n.remove());
          }),
          document.body.appendChild(n),
          setTimeout(() => {
            ((n.style.animation = "slideOutRight 0.5s ease"),
              setTimeout(() => n.remove(), 500));
          }, 8e3),
          requestBrowserNotification(t, e));
      }
      function playNotificationSound() {
        try {
          const t = new (window.AudioContext || window.webkitAudioContext)(),
            e = (e, n, o) => {
              const a = t.createOscillator(),
                i = t.createGain();
              (a.connect(i),
                i.connect(t.destination),
                (a.frequency.value = e),
                (a.type = "sine"),
                (i.gain.value = 0.3),
                a.start(n),
                a.stop(n + o));
            },
            n = t.currentTime;
          (e(800, n, 0.15), e(1e3, n + 0.2, 0.15), e(1200, n + 0.4, 0.25));
        } catch (t) {
          console.log("No se pudo reproducir sonido");
        }
      }
      async function requestBrowserNotification(t, e) {
        if ("Notification" in window) {
          if ("default" === Notification.permission) {
            if ("denied" === (await Notification.requestPermission()))
              return void console.log("Permiso de notificaciones denegado");
          }
          if ("granted" === Notification.permission) {
            "vibrate" in navigator && navigator.vibrate([200, 100, 200]);
            const n = {
              body: `Cliente: ${e}\n${t.items
                .slice(0, 2)
                .map((t) => `‚Ä¢ ${t.quantity}x ${t.name}`)
                .join(
                  "\n",
                )}${t.items.length > 2 ? `\n+${t.items.length - 2} productos m√°s` : ""}\n\nTotal: ${Utils.formatCurrency(t.total)}`,
              icon: "/image.png",
              badge: "/icon-192.png",
              tag: `order-${t.id}`,
              requireInteraction: !0,
              silent: !1,
              vibrate: [200, 100, 200],
              timestamp: Date.now(),
              data: { orderId: t.id, section: "orders" },
            };
            if (
              "serviceWorker" in navigator &&
              navigator.serviceWorker.controller
            )
              navigator.serviceWorker.controller.postMessage({
                type: "SHOW_NOTIFICATION",
                title: "üîî Nuevo Pedido - Lazos de Amor",
                options: n,
              });
            else {
              const t = new Notification("üîî Nuevo Pedido - Lazos de Amor", n);
              ((t.onclick = () => {
                (window.focus(), showSection("orders"), t.close());
              }),
                "ontouchstart" in window || setTimeout(() => t.close(), 15e3));
            }
          }
        } else console.log("Notificaciones no soportadas en este navegador");
      }
      function showNotificationPermissionModal() {
        document
          .getElementById("notification-permission-modal")
          .classList.add("show");
      }
      function closeNotificationModal() {
        document
          .getElementById("notification-permission-modal")
          .classList.remove("show");
      }
      async function acceptNotifications() {
        document
          .getElementById("notification-permission-modal")
          .classList.remove("show");
        try {
          if ("granted" === (await Notification.requestPermission())) {
            const t = {
              body: "Recibir√°s alertas de nuevos pedidos en tiempo real",
              icon: "/image.png",
              badge: "/icon-192.png",
              requireInteraction: !1,
              vibrate: [200, 100, 200],
            };
            if (
              "serviceWorker" in navigator &&
              navigator.serviceWorker.controller
            )
              navigator.serviceWorker.controller.postMessage({
                type: "SHOW_NOTIFICATION",
                title: "‚úÖ Notificaciones Activadas",
                options: t,
              });
            else {
              const e = new Notification("‚úÖ Notificaciones Activadas", t);
              setTimeout(() => e.close(), 3e3);
            }
          }
        } catch (t) {
          console.error("Error al solicitar permisos de notificaci√≥n:", t);
        }
      }
      ("serviceWorker" in navigator &&
        navigator.serviceWorker.addEventListener("message", (t) => {
          t.data &&
            "NAVIGATE_TO_ORDERS" === t.data.type &&
            showSection("orders");
        }),
        "Notification" in window &&
          "default" === Notification.permission &&
          setTimeout(() => {
            showNotificationPermissionModal();
          }, 3e3),
        window.addEventListener("storage", (t) => {
          if ("kitchenNotification" === t.key && t.newValue) {
            (showKitchenReadyNotification(JSON.parse(t.newValue)),
              localStorage.removeItem("kitchenNotification"));
          }
        }));
      let lastNotifiedOrders = new Set();
      function showKitchenReadyNotification(t) {
        playKitchenNotificationSound();
        const e = document.createElement("div");
        ((e.style.cssText =
          "\n\t\t\t\tposition: fixed;\n\t\t\t\ttop: 80px;\n\t\t\t\tright: 30px;\n\t\t\t\tbackground: linear-gradient(135deg, #4caf50 0%, #45a049 100%);\n\t\t\t\tcolor: #fff;\n\t\t\t\tpadding: 20px 30px;\n\t\t\t\tborder-radius: 12px;\n\t\t\t\tbox-shadow: 0 8px 30px rgba(76, 175, 80, 0.5);\n\t\t\t\tz-index: 10000;\n\t\t\t\tfont-size: 16px;\n\t\t\t\tfont-weight: 600;\n\t\t\t\tanimation: slideInRight 0.5s ease;\n\t\t\t\tmin-width: 300px;\n\t\t\t"),
          (e.innerHTML = `\n\t\t\t\t<div style="display: flex; align-items: center; gap: 15px;">\n\t\t\t\t\t<span style="font-size: 40px;">‚úÖ</span>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div style="font-size: 18px; margin-bottom: 5px;">¬°Pedido Listo!</div>\n\t\t\t\t\t\t<div style="font-size: 14px; opacity: 0.9;">Mesa ${t.tableNumber}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`),
          document.body.appendChild(e),
          setTimeout(() => {
            ((e.style.animation = "slideOutRight 0.5s ease"),
              setTimeout(() => e.remove(), 500));
          }, 5e3),
          loadInitialData().then(() => {
            renderAllSections();
          }));
      }
      function playKitchenNotificationSound() {
        try {
          const t = new (window.AudioContext || window.webkitAudioContext)(),
            e = (e, n, o) => {
              const a = t.createOscillator(),
                i = t.createGain();
              (a.connect(i),
                i.connect(t.destination),
                (a.frequency.value = e),
                (a.type = "sine"),
                (i.gain.value = 0.3),
                a.start(n),
                a.stop(n + o));
            },
            n = t.currentTime;
          (e(600, n, 0.15), e(800, n + 0.2, 0.15), e(1e3, n + 0.4, 0.3));
        } catch (t) {
          console.log("No se pudo reproducir sonido");
        }
      }
      setInterval(async () => {
        const t = AppState.orders.filter(
          (t) =>
            "pending" === t.status &&
            t.items.length > 0 &&
            t.items.every((t) => "ready" === t.kitchenStatus) &&
            t.kitchenNotifiedAt &&
            !lastNotifiedOrders.has(t.id),
        );
        for (const e of t) {
          const t = new Date(e.kitchenNotifiedAt).getTime();
          Date.now() - t < 1e4 &&
            (lastNotifiedOrders.add(e.id),
            showKitchenReadyNotification({
              tableNumber: e.tableNumber,
              orderId: e.id,
              timestamp: e.kitchenNotifiedAt,
            }));
        }
        lastNotifiedOrders.size > 50 && lastNotifiedOrders.clear();
      }, 2e3);
      const style = document.createElement("style");
      function showSection(t) {
        document
          .querySelectorAll(".section")
          .forEach((t) => t.classList.remove("active"));
        const e = document.getElementById(t);
        (e && e.classList.add("active"),
          document
            .querySelectorAll(".menu li")
            .forEach((t) => t.classList.remove("active")));
        const n = document.querySelector(`[onclick*="${t}"]`)?.closest("li");
        (n && n.classList.add("active"),
          document.querySelectorAll("nav button").forEach((t) => {
            (t.classList.remove("text-primary"),
              t.classList.add("text-slate-400"));
          }));
        const o = document.querySelector(`nav button[onclick*="${t}"]`);
        (o &&
          (o.classList.remove("text-slate-400"),
          o.classList.add("text-primary")),
          "menu-config" === t ? stopAutoRefresh() : startAutoRefresh(),
          "dashboard" === t && renderDashboard(),
          "orders" === t && renderOrders(),
          "menu-config" === t && renderMenuConfig(),
          "transactions" === t && renderTransactions(),
          "system-config" === t && updateSystemInfo());
      }
      async function refreshData() {
        const t = event.target;
        ((t.disabled = !0),
          (t.textContent = "‚è≥ Actualizando..."),
          await loadInitialData(),
          renderAllSections(),
          (t.disabled = !1),
          (t.innerHTML = "üîÑ Actualizar"));
        const e = document.createElement("div");
        ((e.style.cssText =
          "position: fixed; top: 20px; right: 20px; background: #ffffff; color: #000000; padding: 15px 25px; border-radius: 8px; box-shadow: 0 4px 12px rgba(255,255,255,0.3); z-index: 9999; animation: slideIn 0.3s ease;"),
          (e.textContent = "‚úÖ Datos actualizados"),
          document.body.appendChild(e),
          setTimeout(() => {
            ((e.style.animation = "slideOut 0.3s ease"),
              setTimeout(() => e.remove(), 300));
          }, 2e3));
      }
      function renderAllSections() {
        (renderDashboard(),
          renderOrders(),
          renderMenuConfig(),
          renderTransactions());
      }
      function renderDashboard() {
        const t = AppState.menuItems.filter((t) => t.available).length,
          e = AppState.orders.filter((t) => "pending" === t.status).length,
          n = Utils.getDateKey(),
          o = Utils.getMonthKey();
        let a = 0,
          i = 0,
          r = 0,
          s = 0;
        AppState.orders
          .filter((t) => "completed" === t.status)
          .forEach((t) => {
            const e = Utils.getDateKeyFromISO(t.completedAt),
              d = Utils.getMonthKeyFromISO(t.completedAt);
            let l = 0;
            (t.items.forEach((t) => {
              l += t.price * t.quantity;
            }),
              e === n && ((a += l), r++),
              d === o && ((i += l), s++));
          });
        const d = s > 0 ? i / s : 0,
          l = new Date().getFullYear();
        let c = 0,
          u = 0;
        AppState.orders
          .filter((t) => "completed" === t.status)
          .forEach((t) => {
            if (new Date(t.completedAt).getFullYear() === l) {
              let e = 0;
              (t.items.forEach((t) => {
                e += t.price * t.quantity;
              }),
                (c += e),
                u++);
            }
          });
        const p = Utils.getLastMonthKey();
        let m = 0;
        AppState.orders
          .filter((t) => "completed" === t.status)
          .forEach((t) => {
            if (Utils.getMonthKeyFromISO(t.completedAt) === p) {
              let e = 0;
              (t.items.forEach((t) => {
                e += t.price * t.quantity;
              }),
                (m += e));
            }
          });
        const g = m > 0 ? ((i - m) / m) * 100 : 0,
          f = {};
        AppState.orders
          .filter((t) => "completed" === t.status)
          .forEach((t) => {
            const e = Utils.getDateKeyFromISO(t.completedAt);
            f[e] || (f[e] = 0);
            let n = 0;
            (t.items.forEach((t) => {
              n += t.price * t.quantity;
            }),
              (f[e] += n));
          });
        let y = "-",
          h = 0;
        Object.entries(f).forEach(([t, e]) => {
          if (e > h) {
            h = e;
            const [n, o, a] = t.split("-");
            y = `${a}/${o}`;
          }
        });
        const b = {};
        AppState.orders
          .filter((t) => "completed" === t.status)
          .forEach((t) => {
            const e = new Date(t.completedAt).getHours();
            (b[e] || (b[e] = 0), b[e]++);
          });
        let v = "-",
          x = 0;
        (Object.entries(b).forEach(([t, e]) => {
          e > x && ((x = e), (v = `${t}:00`));
        }),
          (document.getElementById("stat-sales").textContent =
            Utils.formatCurrency(a)),
          (document.getElementById("stat-sales-count").textContent =
            `${r} pedidos`),
          (document.getElementById("stat-month").textContent =
            Utils.formatCurrency(i)),
          (document.getElementById("stat-month-count").textContent =
            `${s} pedidos`),
          (document.getElementById("stat-avg-ticket").textContent =
            Utils.formatCurrency(d)),
          (document.getElementById("stat-orders").textContent = e),
          (document.getElementById("stat-products").textContent =
            `${t} productos`),
          (document.getElementById("stat-year").textContent =
            Utils.formatCurrency(c)),
          (document.getElementById("stat-year-count").textContent =
            `${u} pedidos`),
          (document.getElementById("stat-growth").textContent =
            g >= 0 ? `+${g.toFixed(1)}%` : `${g.toFixed(1)}%`),
          (document.getElementById("stat-growth").style.color =
            g >= 0 ? "#4caf50" : "#f44336"),
          (document.getElementById("stat-best-day").textContent = y),
          (document.getElementById("stat-best-day-amount").textContent =
            Utils.formatCurrency(h)),
          (document.getElementById("stat-peak-hour").textContent = v),
          (document.getElementById("stat-peak-hour-orders").textContent =
            `${x} pedidos`),
          renderSalesChart(),
          renderProductsChart(),
          renderMonthlyChart(),
          renderCategoryChart());
        const I = document.getElementById("dashboard-orders-realtime"),
          w = AppState.orders
            .filter((t) => "pending" === t.status)
            .sort((t, e) => new Date(e.createdAt) - new Date(t.createdAt))
            .slice(0, 6);
        0 === w.length
          ? (I.innerHTML =
              '<p style="text-align: center; color: #94a3b8; padding: 40px;">No hay pedidos activos</p>')
          : (I.innerHTML = `\n\t\t\t\t\t<div id="orders-scroll-container" class="flex overflow-x-auto hide-scrollbar gap-4" style="scroll-behavior: smooth;">\n\t\t\t\t\t\t${w
              .map(
                (t) =>
                  `\n\t\t\t\t\t\t\t<div class="flex-shrink-0" style="width: 280px; background: #f8f9fa; padding: 20px; border-radius: 20px; cursor: pointer; border: 1px solid #e2e8f0; transition: all 0.3s;" onclick="showSection('orders')" onmouseover="this.style.borderColor='#FF5E5E'; this.style.boxShadow='0 4px 12px rgba(255, 94, 94, 0.15)'" onmouseout="this.style.borderColor='#e2e8f0'; this.style.boxShadow='none'">\n\t\t\t\t\t\t\t\t<div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">\n\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t<span style="color: #FF5E5E; font-weight: 700; font-size: 14px;">#${t.id.substring(0, 6)}</span>\n\t\t\t\t\t\t\t\t\t\t<p style="color: #94a3b8; font-size: 10px; margin-top: 4px;">${Utils.formatDate(t.createdAt)}</p>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<span style="background: rgba(217, 142, 115, 0.15); color: #D98E73; font-size: 10px; font-weight: 700; padding: 6px 12px; border-radius: 20px; text-transform: uppercase;">Pendiente</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px;">\n\t\t\t\t\t\t\t\t\t<div style="width: 40px; height: 40px; background: white; border-radius: 12px; display: flex; align-items: center; justify-content: center;">\n\t\t\t\t\t\t\t\t\t\t<span class="material-icons-round" style="color: #94a3b8; font-size: 20px;">inventory_2</span>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<span style="font-size: 13px; color: #64748b;">‚Ä¢ ${t.items.length}x producto${t.items.length > 1 ? "s" : ""}</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t${t.items
                    .slice(0, 2)
                    .map(
                      (t) =>
                        `\n\t\t\t\t\t\t\t\t\t<div style="font-size: 12px; color: #475569; margin-bottom: 4px;">‚Ä¢ ${t.quantity}x ${t.name}</div>\n\t\t\t\t\t\t\t\t`,
                    )
                    .join(
                      "",
                    )}\n\t\t\t\t\t\t\t\t${t.items.length > 2 ? `<div style="font-size: 12px; color: #94a3b8; margin-top: 4px;">+${t.items.length - 2} m√°s...</div>` : ""}\n\t\t\t\t\t\t\t\t<div style="display: flex; justify-content: space-between; align-items: end; padding-top: 15px; border-top: 1px solid #e2e8f0; margin-top: 15px;">\n\t\t\t\t\t\t\t\t\t<span style="font-size: 10px; text-transform: uppercase; font-weight: 700; color: #cbd5e1; letter-spacing: 0.05em;">Total</span>\n\t\t\t\t\t\t\t\t\t<span style="font-size: 20px; font-weight: 700; color: #FF5E5E;">${Utils.formatCurrency(t.total)}</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t`,
              )
              .join("")}\n\t\t\t\t\t</div>\n\t\t\t\t`);
      }
      function scrollOrdersLeft() {
        const t = document.getElementById("orders-scroll-container");
        t && t.scrollBy({ left: -300, behavior: "smooth" });
      }
      function scrollOrdersRight() {
        const t = document.getElementById("orders-scroll-container");
        t && t.scrollBy({ left: 300, behavior: "smooth" });
      }
      ((style.textContent =
        "\n\t\t\t@keyframes slideInRight {\n\t\t\t\tfrom {\n\t\t\t\t\ttransform: translateX(400px);\n\t\t\t\t\topacity: 0;\n\t\t\t\t}\n\t\t\t\tto {\n\t\t\t\t\ttransform: translateX(0);\n\t\t\t\t\topacity: 1;\n\t\t\t\t}\n\t\t\t}\n\t\t\t@keyframes slideOutRight {\n\t\t\t\tfrom {\n\t\t\t\t\ttransform: translateX(0);\n\t\t\t\t\topacity: 1;\n\t\t\t\t}\n\t\t\t\tto {\n\t\t\t\t\ttransform: translateX(400px);\n\t\t\t\t\topacity: 0;\n\t\t\t\t}\n\t\t\t}\n\t\t"),
        document.head.appendChild(style));
      let salesChartInstance = null,
        productsChartInstance = null;
      function renderSalesChart() {
        const t = document.getElementById("sales-chart");
        if (!t) return;
        const e = t.getContext("2d");
        salesChartInstance && salesChartInstance.destroy();
        const n = [],
          o = {};
        for (let t = 6; t >= 0; t--) {
          const e = new Date();
          e.setDate(e.getDate() - t);
          const a = Utils.getDateKey(e);
          (n.push(a), (o[a] = 0));
        }
        AppState.orders
          .filter((t) => "completed" === t.status)
          .forEach((t) => {
            const e = Utils.getDateKeyFromISO(t.completedAt);
            if (o.hasOwnProperty(e)) {
              let n = 0;
              (t.items.forEach((t) => {
                n += t.price * t.quantity;
              }),
                (o[e] += n));
            }
          });
        const a = n.map((t) => {
            const [e, n, o] = t.split("-");
            return `${o}/${n}`;
          }),
          i = n.map((t) => o[t]);
        salesChartInstance = new Chart(e, {
          type: "line",
          data: {
            labels: a,
            datasets: [
              {
                label: "Ventas",
                data: i,
                borderColor: "rgb(76, 175, 80)",
                backgroundColor: "rgba(76, 175, 80, 0.1)",
                tension: 0.4,
                fill: !0,
              },
            ],
          },
          options: {
            responsive: !0,
            maintainAspectRatio: !0,
            plugins: {
              legend: { display: !1 },
              tooltip: {
                callbacks: {
                  label: function (t) {
                    return Utils.formatCurrency(t.parsed.y);
                  },
                },
              },
            },
            scales: {
              y: {
                beginAtZero: !0,
                ticks: {
                  callback: function (t) {
                    return "$" + (t / 1e3).toFixed(0) + "k";
                  },
                },
              },
            },
          },
        });
      }
      function renderProductsChart() {
        const t = document.getElementById("products-chart");
        if (!t) return;
        const e = t.getContext("2d");
        productsChartInstance && productsChartInstance.destroy();
        const n = {};
        AppState.orders
          .filter((t) => "completed" === t.status)
          .forEach((t) => {
            t.items.forEach((t) => {
              const e = t.name;
              (n[e] || (n[e] = 0), (n[e] += t.quantity));
            });
          });
        const o = Object.entries(n)
          .sort((t, e) => e[1] - t[1])
          .slice(0, 5);
        if (0 === o.length)
          return (
            (e.font = "14px Arial"),
            (e.fillStyle = "#999"),
            (e.textAlign = "center"),
            void e.fillText(
              "No hay datos disponibles",
              t.width / 2,
              t.height / 2,
            )
          );
        const a = o.map(([t]) => t),
          i = o.map(([, t]) => t);
        productsChartInstance = new Chart(e, {
          type: "bar",
          data: {
            labels: a,
            datasets: [
              {
                label: "Unidades Vendidas",
                data: i,
                backgroundColor: [
                  "rgba(255, 107, 53, 0.8)",
                  "rgba(76, 175, 80, 0.8)",
                  "rgba(33, 150, 243, 0.8)",
                  "rgba(255, 193, 7, 0.8)",
                  "rgba(156, 39, 176, 0.8)",
                ],
                borderColor: [
                  "rgb(255, 107, 53)",
                  "rgb(76, 175, 80)",
                  "rgb(33, 150, 243)",
                  "rgb(255, 193, 7)",
                  "rgb(156, 39, 176)",
                ],
                borderWidth: 2,
              },
            ],
          },
          options: {
            responsive: !0,
            maintainAspectRatio: !0,
            plugins: { legend: { display: !1 } },
            scales: { y: { beginAtZero: !0, ticks: { stepSize: 1 } } },
          },
        });
      }
      let monthlyChartInstance = null,
        categoryChartInstance = null;
      function renderMonthlyChart() {
        const t = document.getElementById("monthly-chart");
        if (!t) return;
        const e = t.getContext("2d");
        monthlyChartInstance && monthlyChartInstance.destroy();
        const n = [],
          o = {};
        for (let t = 5; t >= 0; t--) {
          const e = new Date();
          e.setMonth(e.getMonth() - t);
          const a = Utils.getMonthKey(e);
          (n.push(a), (o[a] = 0));
        }
        AppState.orders
          .filter((t) => "completed" === t.status)
          .forEach((t) => {
            const e = Utils.getMonthKeyFromISO(t.completedAt);
            if (o.hasOwnProperty(e)) {
              let n = 0;
              (t.items.forEach((t) => {
                n += t.price * t.quantity;
              }),
                (o[e] += n));
            }
          });
        const a = n.map((t) => {
            const [e, n] = t.split("-");
            return [
              "Ene",
              "Feb",
              "Mar",
              "Abr",
              "May",
              "Jun",
              "Jul",
              "Ago",
              "Sep",
              "Oct",
              "Nov",
              "Dic",
            ][parseInt(n) - 1];
          }),
          i = n.map((t) => o[t]);
        monthlyChartInstance = new Chart(e, {
          type: "bar",
          data: {
            labels: a,
            datasets: [
              {
                label: "Ventas",
                data: i,
                backgroundColor: "rgba(76, 175, 80, 0.6)",
                borderColor: "rgb(76, 175, 80)",
                borderWidth: 2,
              },
            ],
          },
          options: {
            responsive: !0,
            maintainAspectRatio: !0,
            plugins: {
              legend: { display: !1 },
              tooltip: {
                callbacks: {
                  label: function (t) {
                    return Utils.formatCurrency(t.parsed.y);
                  },
                },
              },
            },
            scales: {
              y: {
                beginAtZero: !0,
                ticks: {
                  callback: function (t) {
                    return "$" + (t / 1e3).toFixed(0) + "k";
                  },
                },
              },
            },
          },
        });
      }
      function renderCategoryChart() {
        const t = document.getElementById("category-chart");
        if (!t) return;
        const e = t.getContext("2d");
        categoryChartInstance && categoryChartInstance.destroy();
        const n = {};
        AppState.orders
          .filter((t) => "completed" === t.status)
          .forEach((t) => {
            t.items.forEach((t) => {
              const e = AppState.menuItems.find((e) => e.name === t.name),
                o = e?.category || "Sin categor√≠a";
              (n[o] || (n[o] = 0), (n[o] += t.quantity));
            });
          });
        const o = Object.entries(n)
          .sort((t, e) => e[1] - t[1])
          .slice(0, 6);
        if (0 === o.length)
          return (
            (e.font = "14px Arial"),
            (e.fillStyle = "#999"),
            (e.textAlign = "center"),
            void e.fillText(
              "No hay datos disponibles",
              t.width / 2,
              t.height / 2,
            )
          );
        const a = o.map(([t]) => t),
          i = o.map(([, t]) => t);
        categoryChartInstance = new Chart(e, {
          type: "doughnut",
          data: {
            labels: a,
            datasets: [
              {
                data: i,
                backgroundColor: [
                  "rgba(255, 107, 53, 0.7)",
                  "rgba(76, 175, 80, 0.7)",
                  "rgba(33, 150, 243, 0.7)",
                  "rgba(255, 193, 7, 0.7)",
                  "rgba(156, 39, 176, 0.7)",
                  "rgba(233, 30, 99, 0.7)",
                ],
                borderColor: "#fff",
                borderWidth: 2,
              },
            ],
          },
          options: {
            responsive: !0,
            maintainAspectRatio: !0,
            plugins: {
              legend: {
                position: "right",
                labels: { boxWidth: 15, padding: 10 },
              },
              tooltip: {
                callbacks: {
                  label: function (t) {
                    const e = t.label || "",
                      n = t.parsed || 0;
                    return `${e}: ${n} (${((n / t.dataset.data.reduce((t, e) => t + e, 0)) * 100).toFixed(1)}%)`;
                  },
                },
              },
            },
          },
        });
      }
      function renderOrders() {
        const t = document.getElementById("orders-list"),
          e = AppState.orders.filter((t) => "pending" === t.status);
        0 !== e.length
          ? (t.innerHTML = e
              .map(
                (t) =>
                  `\n\t\t\t\t<div class="order-card">\n\t\t\t\t\t<div class="order-header">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<strong style="color: var(--accent);">${t.customerData && t.customerData.name ? "üõçÔ∏è Pedido de " + t.customerData.name : "üì¶ Pedido Cat√°logo Virtual"}</strong>\n\t\t\t\t\t\t\t<div class="small">${Utils.formatDate(t.createdAt)}</div>\n\t\t\t\t\t\t\t${t.customerData ? `\n\t\t\t\t\t\t\t\t<div class="small" style="margin-top: 5px;">\n\t\t\t\t\t\t\t\t\t<strong>Cliente:</strong> ${t.customerData.name}<br>\n\t\t\t\t\t\t\t\t\t<strong>Tel:</strong> ${t.customerData.phone}<br>\n\t\t\t\t\t\t\t\t\t<strong>Direcci√≥n:</strong> ${t.customerData.address}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t` : ""}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<span class="badge badge-warning">Pendiente</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="order-items-list">\n\t\t\t\t\t\t${t.items.map((t) => `\n\t\t\t\t\t\t\t<div class="order-item-line">\n\t\t\t\t\t\t\t\t<div>${t.quantity}x ${t.name} ${t.notes ? `<br><small style="color: var(--muted);">Nota: ${t.notes}</small>` : ""}</div>\n\t\t\t\t\t\t\t\t<div>${Utils.formatCurrency(t.price * t.quantity)}</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t`).join("")}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div style="text-align: right; font-size: 20px; font-weight: 700; color: var(--success); margin-top: 10px;">\n\t\t\t\t\t\tTotal: ${Utils.formatCurrency(t.total)}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div style="margin-top: 15px; display: flex; gap: 10px; flex-wrap: wrap;">\n\t\t\t\t\t\t<button class="btn btn-success" onclick="completeOrder('${t.id}')">‚úì Completar y Facturar</button>\n\t\t\t\t\t\t<button class="btn btn-danger" onclick="cancelOrder('${t.id}')">‚úï Cancelar</button>\n\t\t\t\t\t\t${t.customerData && t.customerData.phone ? `\n\t\t\t\t\t\t\t<button class="btn" style="background: #25D366; color: white; border: none;" onclick="contactCustomerWhatsApp('${t.id}')">üí¨ Contactar Cliente</button>\n\t\t\t\t\t\t` : ""}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`,
              )
              .join(""))
          : (t.innerHTML =
              '<p class="text-center" style="color: var(--muted); padding: 40px;">No hay pedidos activos</p>');
      }
      let isCompletingOrder = !1;
      async function completeOrder(t) {
        if (isCompletingOrder) return;
        const e = AppState.orders.find((e) => e.id === t);
        if (!e) return void alert("‚ùå Pedido no encontrado");
        const n =
          e.customerData && e.customerData.name
            ? "Pedido de " + e.customerData.name
            : "Pedido Cat√°logo Virtual";
        if (
          confirm(
            `¬øCompletar pedido de ${n}?\nTotal: ${Utils.formatCurrency(e.total)}`,
          )
        ) {
          isCompletingOrder = !0;
          try {
            (autoRefreshInterval && clearInterval(autoRefreshInterval),
              (e.status = "completed"),
              (e.completedAt = new Date().toISOString()));
            const t = await generateInvoicePDF(e),
              o = {
                id: Utils.generateId(),
                orderId: e.id,
                tableNumber: e.tableNumber || "Cat√°logo Virtual",
                amount: e.total,
                type: "sale",
                date: new Date().toISOString(),
                concept: `${n} - ${e.items.length} productos`,
                invoicePDF: t,
                customerData: e.customerData,
              };
            AppState.transactions.push(o);
            try {
              (await Promise.all([
                API.save("orders", AppState.orders),
                API.save("transactions", AppState.transactions),
              ]),
                await loadInitialData(),
                alert("‚úÖ Pedido completado y guardado exitosamente"));
            } catch (t) {
              (console.error("Error guardando en servidor:", t),
                alert(
                  "‚ö†Ô∏è Pedido completado localmente.\n\nNo se pudo sincronizar con el servidor.\nLos datos se guardar√°n cuando haya conexi√≥n.",
                ));
            }
            (renderOrders(), renderDashboard(), renderTransactions());
          } catch (t) {
            (console.error("Error completando orden:", t),
              alert("‚ùå ERROR AL COMPLETAR PEDIDO\n\n" + t.message));
          } finally {
            ((isCompletingOrder = !1), startAutoRefresh());
          }
        }
      }
      let isCancellingOrder = !1;
      async function cancelOrder(t) {
        if (
          !isCancellingOrder &&
          confirm("¬øEst√°s seguro de cancelar este pedido?")
        ) {
          isCancellingOrder = !0;
          try {
            autoRefreshInterval && clearInterval(autoRefreshInterval);
            const e = AppState.orders.find((e) => e.id === t);
            if (!e) throw new Error("Pedido no encontrado");
            ((e.status = "cancelled"), renderOrders(), renderDashboard());
            try {
              (await API.save("orders", AppState.orders),
                await loadInitialData(),
                alert("‚úÖ Pedido cancelado y sincronizado con el servidor"));
            } catch (t) {
              (console.error("Error al sincronizar:", t),
                alert(
                  "‚ö†Ô∏è Pedido cancelado localmente.\n\nNo se pudo sincronizar con el servidor.\nLos cambios se guardar√°n cuando se restablezca la conexi√≥n.",
                ));
            }
          } catch (t) {
            (console.error("Error cancelando orden:", t),
              alert("‚ùå ERROR AL CANCELAR PEDIDO\n\nError: " + t.message));
          } finally {
            ((isCancellingOrder = !1), startAutoRefresh());
          }
        }
      }
      function contactCustomerWhatsApp(t) {
        const e = AppState.orders.find((e) => e.id === t);
        if (!e || !e.customerData || !e.customerData.phone)
          return void alert("‚ö†Ô∏è No hay n√∫mero de tel√©fono para este pedido");
        const n = e.customerData,
          o = n.phone.replace(/[\s\-\(\)]/g, ""),
          a = new Date(e.timestamp).toLocaleDateString("es-CO", {
            day: "numeric",
            month: "long",
            year: "numeric",
          }),
          i = e.items
            .map(
              (t) =>
                `- ${t.name} x${t.quantity} (${Utils.formatCurrency(t.price * t.quantity)})`,
            )
            .join("\n"),
          r =
            `¬°Hola ${n.name}! üëã\n\nTe escribimos de *Lazos de Amor* üéÄ\n\nQueremos confirmar tu pedido del ${a}:\n\n` +
            i +
            "\n\n" +
            `*Total: ${Utils.formatCurrency(e.total)}*\n\n` +
            `Direcci√≥n de entrega: ${n.address || "No especificada"}\n\n¬øTodo est√° correcto? ¬øTienes alguna pregunta? üòä`,
          s = `https://api.whatsapp.com/send?phone=${o}&text=${encodeURIComponent(r)}`;
        window.open(s, "_blank");
      }
      function renderMenuConfig() {
        ((document.querySelector("#menu-table tbody").innerHTML =
          AppState.menuItems
            .map((t) => {
              const e = t.cost || 0,
                n = t.price - e,
                o = t.price > 0 ? ((n / t.price) * 100).toFixed(1) : 0,
                a =
                  t.images && t.images.length > 0
                    ? t.images
                    : t.image
                      ? [t.image]
                      : [],
                i = a.length > 0 ? a[0] : "";
              return `\n\t\t\t\t<tr>\n\t\t\t\t\t<td data-label="Producto">\n\t\t\t\t\t\t<div style="display: flex; align-items: center; gap: 10px;">\n\t\t\t\t\t\t\t<div style="position: relative;">\n\t\t\t\t\t\t\t\t${i ? `<img src="${i}" style="width: 50px; height: 50px; object-fit: cover; border-radius: 8px;">` : ""}\n\t\t\t\t\t\t\t\t${a.length > 1 ? `<span style="position: absolute; bottom: -4px; right: -4px; background: var(--accent); color: white; border-radius: 50%; width: 18px; height: 18px; display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: 700; border: 2px solid white;">+${a.length - 1}</span>` : ""}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<strong>${t.name}</strong>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td data-label="Descripci√≥n" style="max-width: 200px; color: var(--muted); font-size: 13px;">${t.description || "-"}</td>\n\t\t\t\t\t<td data-label="Categor√≠a"><span class="badge badge-info">${t.category}</span></td>\n\t\t\t\t\t<td data-label="Costo">${Utils.formatCurrency(e)}</td>\n\t\t\t\t\t<td data-label="Precio"><strong>${Utils.formatCurrency(t.price)}</strong></td>\n\t\t\t\t\t<td data-label="Ganancia" style="color: ${n > 0 ? "var(--accent)" : "#999"}; font-weight: 600;">${Utils.formatCurrency(n)}</td>\n\t\t\t\t\t<td data-label="Margen">\n\t\t\t\t\t\t<span class="badge" style="background: ${o > 50 ? "#4caf50" : o > 30 ? "#ff9800" : "#999"}; color: #fff; font-weight: 600;">\n\t\t\t\t\t\t\t${o}%\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td data-label="Estado">\n\t\t\t\t\t\t<button \n\t\t\t\t\t\t\tclass="btn btn-small" \n\t\t\t\t\t\t\tonclick="toggleProductAvailability('${t.id}')" \n\t\t\t\t\t\t\tstyle="background: ${t.available ? "#4caf50" : "#666"}; color: #fff; border: none; padding: 6px 14px; font-size: 12px; min-width: 90px;"\n\t\t\t\t\t\t\ttitle="${t.available ? "Click para ocultar del men√∫" : "Click para mostrar en el men√∫"}">\n\t\t\t\t\t\t\t${t.available ? "üëÅÔ∏è Visible" : "üö´ Oculto"}\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td data-label="Acciones">\n\t\t\t\t\t\t<button class="btn btn-small btn-secondary" onclick="editMenuItem('${t.id}')" title="Editar producto">‚úèÔ∏è</button>\n\t\t\t\t\t\t<button class="btn btn-small btn-danger" onclick="deleteMenuItem('${t.id}')" title="Eliminar producto">üóëÔ∏è</button>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t`;
            })
            .join("")),
          renderProductsCards(AppState.menuItems));
      }
      function renderProductsCards(t) {
        const e = document.getElementById("products-cards-container");
        e &&
          (0 !== t.length
            ? (e.innerHTML = t
                .map((t) => {
                  const e = t.cost || 0,
                    n = t.price - e,
                    o = t.price > 0 ? ((n / t.price) * 100).toFixed(1) : 0,
                    a = o > 50 ? "#10b981" : o > 30 ? "#f59e0b" : "#6b7280";
                  return `\n\t\t\t\t<div style="background: white; border-radius: 16px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.06); border: 1px solid #e2e8f0; transition: all 0.3s; position: relative; overflow: hidden;" onmouseover="this.style.boxShadow='0 8px 24px rgba(45,90,39,0.12)'; this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='0 2px 8px rgba(0,0,0,0.06)'; this.style.transform='translateY(0)'">\n\t\t\t\t\t\n\t\t\t\t\t\x3c!-- Badge de estado --\x3e\n\t\t\t\t\t<div style="position: absolute; top: 12px; right: 12px;">\n\t\t\t\t\t\t<span style="background: ${t.available ? "#dcfce7" : "#f3f4f6"}; color: ${t.available ? "#15803d" : "#6b7280"}; padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 600; display: flex; align-items: center; gap: 4px;">\n\t\t\t\t\t\t\t<span class="material-icons-round" style="font-size: 14px;">${t.available ? "visibility" : "visibility_off"}</span>\n\t\t\t\t\t\t\t${t.available ? "Visible" : "Oculto"}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t\n\t\t\t\t\t\x3c!-- Imagen y detalles b√°sicos --\x3e\n\t\t\t\t\t<div style="display: flex; gap: 16px; margin-bottom: 16px;">\n\t\t\t\t\t${(() => {
                    const e =
                        t.images && t.images.length > 0
                          ? t.images
                          : t.image
                            ? [t.image]
                            : [],
                      n = e.length > 0 ? e[0] : "";
                    return n
                      ? `\n\t\t\t\t\t\t\t\t<div style="position: relative; width: 80px; height: 80px; border-radius: 12px; overflow: hidden; flex-shrink: 0; background: #f8f9fa;">\n\t\t\t\t\t\t\t\t\t<img src="${n}" style="width: 100%; height: 100%; object-fit: cover;">\n\t\t\t\t\t\t\t\t\t${e.length > 1 ? `\n\t\t\t\t\t\t\t\t\t\t<div style="position: absolute; bottom: 4px; right: 4px; background: var(--accent); color: white; border-radius: 50%; width: 22px; height: 22px; display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: 700; border: 2px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.2);">\n\t\t\t\t\t\t\t\t\t\t\t+${e.length - 1}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t` : ""}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t`
                      : '\n\t\t\t\t\t\t\t\t<div style="width: 80px; height: 80px; border-radius: 12px; background: linear-gradient(135deg, #f8f9fa 0%, #e2e8f0 100%); display: flex; align-items: center; justify-content: center; flex-shrink: 0;">\n\t\t\t\t\t\t\t\t\t<span class="material-icons-round" style="font-size: 40px; color: #cbd5e1;">checkroom</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t';
                  })()}\n\t\t\t\t\t\t\t<h3 style="margin: 0 0 6px 0; font-size: 18px; font-weight: 700; color: #1e293b; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${t.name}</h3>\n\t\t\t\t\t\t\t<p style="margin: 0 0 8px 0; font-size: 13px; color: #64748b; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">${t.description || "Sin descripci√≥n"}</p>\n\t\t\t\t\t\t\t<span style="background: #e0f2fe; color: #0369a1; padding: 4px 10px; border-radius: 8px; font-size: 12px; font-weight: 600; display: inline-block;">${t.category}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t\n\t\t\t\t\t\x3c!-- Informaci√≥n financiera --\x3e\n\t\t\t\t\t<div style="background: #f8f9fa; padding: 12px; border-radius: 10px; margin-bottom: 16px;">\n\t\t\t\t\t\t<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 10px;">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<div style="font-size: 11px; color: #64748b; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px; font-weight: 600;">Costo</div>\n\t\t\t\t\t\t\t\t<div style="font-size: 16px; font-weight: 600; color: #ef4444;">${Utils.formatCurrency(e)}</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<div style="font-size: 11px; color: #64748b; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px; font-weight: 600;">Precio</div>\n\t\t\t\t\t\t\t\t<div style="font-size: 16px; font-weight: 700; color: #FF5E5E;">${Utils.formatCurrency(t.price)}</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<div style="font-size: 11px; color: #64748b; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px; font-weight: 600;">Ganancia</div>\n\t\t\t\t\t\t\t\t<div style="font-size: 15px; font-weight: 600; color: ${n > 0 ? "#10b981" : "#6b7280"};">${Utils.formatCurrency(n)}</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<div style="font-size: 11px; color: #64748b; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px; font-weight: 600;">Margen</div>\n\t\t\t\t\t\t\t\t<div style="font-size: 15px; font-weight: 700; color: ${a};">${o}%</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t\n\t\t\t\t\t\x3c!-- Acciones --\x3e\n\t\t\t\t\t<div style="display: flex; gap: 8px;">\n\t\t\t\t\t\t<button onclick="toggleProductAvailability('${t.id}')" style="flex: 1; background: ${t.available ? "#dcfce7" : "#f3f4f6"}; color: ${t.available ? "#15803d" : "#6b7280"}; border: 2px solid ${t.available ? "#bbf7d0" : "#e5e7eb"}; padding: 10px; border-radius: 10px; font-weight: 600; font-size: 13px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 6px; transition: all 0.3s;" onmouseover="this.style.transform='translateY(-1px)'" onmouseout="this.style.transform='translateY(0)'">\n\t\t\t\t\t\t\t<span class="material-icons-round" style="font-size: 16px;">${t.available ? "visibility_off" : "visibility"}</span>\n\t\t\t\t\t\t\t${t.available ? "Ocultar" : "Mostrar"}\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t<button onclick="editMenuItem('${t.id}')" style="background: #dbeafe; color: #1e40af; border: none; padding: 10px 16px; border-radius: 10px; font-weight: 600; cursor: pointer; transition: all 0.3s;" onmouseover="this.style.background='#bfdbfe'; this.style.transform='translateY(-1px)'" onmouseout="this.style.background='#dbeafe'; this.style.transform='translateY(0)'">\n\t\t\t\t\t\t\t<span class="material-icons-round" style="font-size: 18px;">edit</span>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t<button onclick="deleteMenuItem('${t.id}')" style="background: #fee2e2; color: #dc2626; border: none; padding: 10px 16px; border-radius: 10px; font-weight: 600; cursor: pointer; transition: all 0.3s;" onmouseover="this.style.background='#fecaca'; this.style.transform='translateY(-1px)'" onmouseout="this.style.background='#fee2e2'; this.style.transform='translateY(0)'">\n\t\t\t\t\t\t\t<span class="material-icons-round" style="font-size: 18px;">delete</span>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;
                })
                .join(""))
            : (e.innerHTML =
                '\n\t\t\t\t<div style="background: white; border-radius: 16px; padding: 60px 20px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.06);">\n\t\t\t\t\t<span class="material-icons-round" style="font-size: 64px; color: #cbd5e1; margin-bottom: 16px;">inventory_2</span>\n\t\t\t\t\t<p style="color: #94a3b8; font-size: 16px; margin: 0;">No hay productos</p>\n\t\t\t\t</div>\n\t\t\t'));
      }
      function filterProducts() {
        const t =
            document.getElementById("products-search")?.value.toLowerCase() ||
            "",
          e =
            document.getElementById("products-category-filter")?.value || "all",
          n =
            document.getElementById("products-availability-filter")?.value ||
            "all";
        renderProductsCards(
          AppState.menuItems.filter((o) => {
            const a =
                !t ||
                o.name.toLowerCase().includes(t) ||
                (o.description && o.description.toLowerCase().includes(t)) ||
                o.category.toLowerCase().includes(t),
              i = "all" === e || o.category === e,
              r =
                "all" === n ||
                ("visible" === n && o.available) ||
                ("hidden" === n && !o.available);
            return a && i && r;
          }),
        );
      }
      function openMenuItemModal(t = null) {
        if ((populateCategoriesList(), t)) {
          ((currentEditingMenuItem = AppState.menuItems.find(
            (e) => e.id === t,
          )),
            (document.getElementById("menu-item-modal-title").textContent =
              "Editar Producto"),
            (document.getElementById("item-name").value =
              currentEditingMenuItem.name),
            (document.getElementById("item-description").value =
              currentEditingMenuItem.description || ""),
            (document.getElementById("item-category").value =
              currentEditingMenuItem.category),
            (document.getElementById("item-cost").value =
              currentEditingMenuItem.cost || 0),
            (document.getElementById("item-price").value =
              currentEditingMenuItem.price),
            (document.getElementById("item-available").checked =
              currentEditingMenuItem.available));
          let e = [];
          (currentEditingMenuItem.images &&
          Array.isArray(currentEditingMenuItem.images)
            ? (e = currentEditingMenuItem.images)
            : currentEditingMenuItem.image &&
              (e = [currentEditingMenuItem.image]),
            (document.getElementById("item-images").value = JSON.stringify(e)),
            showImagesPreview(e),
            updateProfitPreview());
        } else
          ((currentEditingMenuItem = null),
            (document.getElementById("menu-item-modal-title").textContent =
              "Nuevo Producto"),
            (document.getElementById("item-name").value = ""),
            (document.getElementById("item-description").value = ""),
            (document.getElementById("item-category").value = ""),
            (document.getElementById("item-cost").value = "0"),
            (document.getElementById("item-price").value = ""),
            (document.getElementById("item-available").checked = !0),
            (document.getElementById("item-images").value = "[]"),
            (document.getElementById("profit-preview").style.display = "none"),
            clearImagesPreview());
        document.getElementById("menu-item-modal").classList.add("show");
      }
      function closeMenuItemModal() {
        (document.getElementById("menu-item-modal").classList.remove("show"),
          (currentEditingMenuItem = null));
      }
      function populateCategoriesList() {
        const t = document.getElementById("categories-list"),
          e = [...new Set(AppState.menuItems.map((t) => t.category))].sort();
        t.innerHTML = e.map((t) => `<option value="${t}">`).join("");
      }
      function editMenuItem(t) {
        openMenuItemModal(t);
      }
      async function readFileAsDataURL(t) {
        return new Promise((e, n) => {
          const o = new FileReader();
          ((o.onload = () => e(o.result)),
            (o.onerror = () =>
              n(o.error || new Error("Error leyendo archivo"))),
            o.readAsDataURL(t));
        });
      }
      async function compressImageFile(t, e = 1280) {
        const n = await readFileAsDataURL(t);
        return new Promise((o, a) => {
          const i = new Image();
          ((i.onload = () => {
            let { width: a, height: r } = i;
            if (a > e || r > e) {
              const t = Math.min(e / a, e / r);
              ((a = Math.round(a * t)), (r = Math.round(r * t)));
            }
            const s = document.createElement("canvas");
            ((s.width = a), (s.height = r));
            s.getContext("2d").drawImage(i, 0, 0, a, r);
            const d = "image/png" === t.type,
              l = d ? "image/png" : "image/jpeg",
              c = d ? 0.9 : 0.82,
              u = s.toDataURL(l, c);
            u.length >= n.length ? o(n) : o(u);
          }),
            (i.onerror = () => a(new Error("No se pudo procesar la imagen"))),
            (i.src = n));
        });
      }
      async function handleMultipleImageUpload(t) {
        if (!t.files || 0 === t.files.length) return;
        const e = document.getElementById("item-images"),
          n = JSON.parse(e.value || "[]"),
          o = 3 - n.length;
        if (o <= 0)
          return (
            Utils.showNotification(
              "Ya tienes 3 im√°genes. Elimina alguna para agregar m√°s",
              "warning",
            ),
            void (t.value = "")
          );
        const a = Array.from(t.files).slice(0, o),
          i = [];
        for (const t of a)
          try {
            const e = await compressImageFile(t);
            i.push(e);
          } catch (e) {
            (console.error("Error procesando imagen:", e),
              Utils.showNotification(
                `No se pudo procesar ${t.name}`,
                "warning",
              ));
          }
        if (i.length > 0) {
          const t = n.concat(i).slice(0, 3);
          ((e.value = JSON.stringify(t)), showImagesPreview(t));
        }
        t.value = "";
      }
      function showImagesPreview(t) {
        const e = document.getElementById("item-images-preview");
        t && 0 !== t.length
          ? (e.innerHTML = t
              .map(
                (t, e) =>
                  `\n\t\t\t<div style="position: relative; display: inline-block;">\n\t\t\t\t<img src="${t}" style="width: 120px; height: 120px; object-fit: cover; border-radius: 8px; border: 2px solid var(--accent);">\n\t\t\t\t<button onclick="removeImage(${e})" style="position: absolute; top: 5px; right: 5px; background: var(--danger); color: #fff; border: 0; border-radius: 50%; width: 25px; height: 25px; cursor: pointer; font-size: 16px; line-height: 1;">‚úï</button>\n\t\t\t\t${0 === e ? '<div style="position: absolute; bottom: 5px; left: 5px; background: var(--accent); color: white; padding: 2px 8px; border-radius: 4px; font-size: 10px; font-weight: 600;">PRINCIPAL</div>' : ""}\n\t\t\t</div>\n\t\t`,
              )
              .join(""))
          : (e.innerHTML = "");
      }
      function removeImage(t) {
        const e = JSON.parse(
          document.getElementById("item-images").value || "[]",
        );
        (e.splice(t, 1),
          (document.getElementById("item-images").value = JSON.stringify(e)),
          showImagesPreview(e));
      }
      function clearImagesPreview() {
        ((document.getElementById("item-images").value = "[]"),
          (document.getElementById("item-image-file").value = ""),
          (document.getElementById("item-images-preview").innerHTML = ""));
      }
      function updateProfitPreview() {
        const t = parseFloat(document.getElementById("item-cost").value) || 0,
          e = parseFloat(document.getElementById("item-price").value) || 0;
        if (e > 0 && t >= 0) {
          const n = e - t,
            o = ((n / e) * 100).toFixed(1);
          ((document.getElementById("profit-amount").textContent =
            Utils.formatCurrency(n)),
            (document.getElementById("profit-margin").textContent = o + "%"),
            (document.getElementById("profit-preview").style.display =
              "block"));
        } else document.getElementById("profit-preview").style.display = "none";
      }
      function showOperationLoading(t = "Procesando...") {
        const e = document.getElementById("operation-status-modal"),
          n = document.getElementById("operation-status-loading"),
          o = document.getElementById("operation-status-error"),
          a = document.getElementById("operation-status-message");
        e &&
          n &&
          o &&
          a &&
          ((a.textContent = t),
          (n.style.display = "flex"),
          (o.style.display = "none"),
          e.classList.add("show"));
      }
      function showOperationError(
        t = "No se pudo completar la acci√≥n. Intenta nuevamente.",
      ) {
        const e = document.getElementById("operation-status-modal"),
          n = document.getElementById("operation-status-loading"),
          o = document.getElementById("operation-status-error"),
          a = document.getElementById("operation-status-error-message");
        e &&
          n &&
          o &&
          a &&
          ((n.style.display = "none"),
          (o.style.display = "flex"),
          (a.textContent = t),
          e.classList.add("show"));
      }
      function hideOperationStatusModal() {
        const t = document.getElementById("operation-status-modal");
        t && t.classList.remove("show");
      }
      function closeOperationStatusModal() {
        hideOperationStatusModal();
      }
      async function saveMenuItem() {
        const t = document.getElementById("item-name").value.trim(),
          e = document.getElementById("item-description").value.trim(),
          n = document.getElementById("item-category").value.trim(),
          o = parseFloat(document.getElementById("item-cost").value) || 0,
          a = parseFloat(document.getElementById("item-price").value),
          i = document.getElementById("item-available").checked,
          r = JSON.parse(document.getElementById("item-images").value || "[]");
        if (!t || !n || !a)
          return void Utils.showNotification(
            "Completa los campos requeridos",
            "warning",
          );
        let s = null;
        if (currentEditingMenuItem) {
          const d = AppState.menuItems.findIndex(
            (t) => t.id === currentEditingMenuItem.id,
          );
          if (-1 === d)
            return void Utils.showNotification(
              "No se encontr√≥ el producto para editar",
              "error",
            );
          ((s = {
            ...currentEditingMenuItem,
            name: t,
            description: e,
            category: n,
            cost: o,
            price: a,
            available: i,
            images: r,
            image: r.length > 0 ? r[0] : "",
          }),
            (AppState.menuItems[d] = s));
        } else
          ((s = {
            id: Utils.generateId(),
            name: t,
            description: e,
            category: n,
            cost: o,
            price: a,
            available: i,
            images: r,
            image: r.length > 0 ? r[0] : "",
          }),
            AppState.menuItems.push(s));
        showOperationLoading("Guardando producto...");
        try {
          (await API.update("menu_items", s.id, s), hideOperationStatusModal());
        } catch (t) {
          return (
            console.error("Error guardando producto:", t),
            void showOperationError(
              "No se pudo guardar el producto. Verifica tu conexi√≥n e intenta nuevamente.",
            )
          );
        }
        (closeMenuItemModal(),
          renderMenuConfig(),
          Utils.showNotification("Producto guardado", "success"));
      }
      async function deleteMenuItem(t) {
        if (!confirm("¬øEliminar este producto?")) return;
        const e = AppState.menuItems.findIndex((e) => e.id === t);
        if (-1 === e)
          return void Utils.showNotification(
            "Producto no encontrado",
            "warning",
          );
        const [n] = AppState.menuItems.splice(e, 1);
        (renderMenuConfig(), showOperationLoading("Eliminando producto..."));
        try {
          (await API.delete("menu_items", t),
            hideOperationStatusModal(),
            Utils.showNotification("Producto eliminado", "success"));
        } catch (t) {
          (console.error("Error eliminando producto:", t),
            AppState.menuItems.splice(e, 0, n),
            renderMenuConfig(),
            showOperationError(
              "No se pudo eliminar el producto. Intenta de nuevo.",
            ));
        }
      }
      async function toggleProductAvailability(t) {
        const e = AppState.menuItems.find((e) => e.id === t);
        if (e) {
          ((e.available = !e.available),
            renderMenuConfig(),
            showOperationLoading("Actualizando producto..."));
          try {
            (await API.update("menu_items", e.id, e),
              hideOperationStatusModal());
          } catch (t) {
            (console.error("Error actualizando disponibilidad:", t),
              (e.available = !e.available),
              renderMenuConfig(),
              showOperationError(
                "No se pudo actualizar la disponibilidad. Intenta de nuevo.",
              ));
          }
        } else Utils.showNotification("Producto no encontrado", "warning");
      }
      function renderTransactions() {
        const t = document.querySelector("#transactions-table tbody"),
          e = [...AppState.transactions].sort(
            (t, e) => new Date(e.date) - new Date(t.date),
          );
        0 !== e.length
          ? (t.innerHTML = e
              .map(
                (t) =>
                  `\n\t\t\t\t<tr>\n\t\t\t\t\t<td data-label="Fecha">${Utils.formatDate(t.date)}</td>\n\t\t\t\t\t<td data-label="Pedido">${t.tableNumber || "-"}</td>\n\t\t\t\t\t<td data-label="Concepto">\n\t\t\t\t\t\t${t.concept}\n\t\t\t\t\t\t${t.customerData ? `<br><small style="color: var(--muted);">Cliente: ${t.customerData.name}</small>` : ""}\n\t\t\t\t\t</td>\n\t\t\t\t\t<td data-label="Monto" style="color: var(--success); font-weight: 600;">${Utils.formatCurrency(t.amount)}</td>\n\t\t\t\t\t<td data-label="Acciones" style="display: flex; gap: 5px;">\n\t\t\t\t\t\t${t.invoicePDF ? `<button class="btn btn-small" style="background: var(--accent);" onclick="viewInvoice('${t.id}')">üìÑ Factura</button>` : ""}\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t`,
              )
              .join(""))
          : (t.innerHTML =
              '<tr><td colspan="5" class="text-center" style="color: var(--muted); padding: 40px;">No hay transacciones registradas</td></tr>');
      }
      async function deleteTransaction(t) {
        confirm("¬øEliminar esta transacci√≥n?") &&
          ((AppState.transactions = AppState.transactions.filter(
            (e) => e.id !== t,
          )),
          await API.save("transactions", AppState.transactions),
          renderTransactions(),
          renderDashboard(),
          Utils.showNotification("Transacci√≥n eliminada", "success"));
      }
      function viewInvoice(t) {
        const e = AppState.transactions.find((e) => e.id === t);
        if (
          (console.log("Transaction found:", e),
          console.log("Invoice PDF exists:", !!e?.invoicePDF),
          console.log("PDF size:", e?.invoicePDF?.length),
          !e || !e.invoicePDF)
        )
          return void alert("Factura no disponible");
        const n = window.open("", "_blank");
        n
          ? n.document.write(
              '<iframe width="100%" height="100%" src="' +
                e.invoicePDF +
                '"></iframe>',
            )
          : alert(
              "Por favor permite las ventanas emergentes para ver la factura",
            );
      }
      let currentOrderTable = null,
        currentOrderItems = [];
      function openOrderModal(t) {
        const e = AppState.tables.find((e) => e.id === t);
        if (e) {
          if (((currentOrderTable = e), e.currentOrder)) {
            const t = AppState.orders.find((t) => t.id === e.currentOrder);
            t && (currentOrderItems = JSON.parse(JSON.stringify(t.items)));
          } else currentOrderItems = [];
          ((document.getElementById("order-modal-title").textContent =
            `Mesa ${e.number} - ${e.currentOrder ? "Editar" : "Nuevo"} Pedido`),
            renderOrderModalMenu(),
            updateOrderSummary(),
            document.getElementById("order-modal").classList.add("show"));
        }
      }
      function closeOrderModal() {
        (document.getElementById("order-modal").classList.remove("show"),
          (currentOrderTable = null),
          (currentOrderItems = []));
      }
      function renderOrderModalMenu() {
        const t = [
          ...new Set(
            AppState.menuItems
              .filter((t) => t.available)
              .map((t) => t.category),
          ),
        ];
        document.getElementById("order-menu-items").innerHTML = t
          .map(
            (t) =>
              `\n\t\t\t\t<div style="margin-bottom: 25px;">\n\t\t\t\t\t<h4 style="color: var(--accent); margin-bottom: 15px; border-bottom: 2px solid var(--accent); padding-bottom: 8px;">${t}</h4>\n\t\t\t\t\t<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px;">\n\t\t\t\t\t\t${AppState.menuItems
                .filter((e) => e.category === t && e.available)
                .map(
                  (t) =>
                    `\n\t\t\t\t\t\t\t\t<div class="menu-item-btn" onclick="addItemToOrder('${t.id}')" style="background: rgba(255,255,255,0.05); padding: 12px; border-radius: 8px; cursor: pointer; transition: all 0.3s; border: 2px solid transparent;" onmouseover="this.style.borderColor='var(--accent)'; this.style.background='rgba(255,255,255,0.1)'" onmouseout="this.style.borderColor='transparent'; this.style.background='rgba(255,255,255,0.05)'">\n\t\t\t\t\t\t\t\t\t<div style="font-weight: 600; margin-bottom: 5px;">${t.name}</div>\n\t\t\t\t\t\t\t\t\t<div style="color: var(--accent); font-size: 18px; font-weight: 700;">${Utils.formatCurrency(t.price)}</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t`,
                )
                .join("")}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`,
          )
          .join("");
      }
      function addItemToOrder(t) {
        const e = AppState.menuItems.find((e) => e.id === t);
        if (!e) return;
        const n = currentOrderItems.find((e) => e.menuItemId === t && !e.notes);
        (n
          ? n.quantity++
          : currentOrderItems.push({
              menuItemId: t,
              name: e.name,
              price: e.price,
              quantity: 1,
              notes: "",
            }),
          updateOrderSummary());
      }
      function updateOrderSummary() {
        const t = document.getElementById("order-items-summary");
        if (0 === currentOrderItems.length)
          return (
            (t.innerHTML =
              '<p style="color: var(--muted); text-align: center; padding: 20px;">No hay productos en el pedido</p>'),
            void (document.getElementById("order-total-amount").textContent =
              Utils.formatCurrency(0))
          );
        const e = currentOrderItems.reduce(
          (t, e) => t + e.price * e.quantity,
          0,
        );
        ((t.innerHTML = currentOrderItems
          .map(
            (t, e) =>
              `\n\t\t\t\t<div style="background: rgba(0,0,0,0.3); padding: 12px; border-radius: 8px; margin-bottom: 8px; border-left: 3px solid var(--accent);">\n\t\t\t\t\t<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">\n\t\t\t\t\t\t<strong>${t.name}</strong>\n\t\t\t\t\t\t<button class="btn btn-small btn-danger" onclick="removeItemFromOrder(${e})" style="padding: 4px 8px;">üóëÔ∏è</button>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div style="display: flex; gap: 10px; align-items: center;">\n\t\t\t\t\t\t<button onclick="changeQuantity(${e}, -1)" style="width: 30px; height: 30px; border-radius: 50%; border: 0; background: #ffffff; color: #000000; cursor: pointer; font-size: 18px;">-</button>\n\t\t\t\t\t\t<span style="font-size: 18px; font-weight: 700; min-width: 30px; text-align: center;">${t.quantity}</span>\n\t\t\t\t\t\t<button onclick="changeQuantity(${e}, 1)" style="width: 30px; height: 30px; border-radius: 50%; border: 0; background: #ffffff; color: #000000; cursor: pointer; font-size: 18px;">+</button>\n\t\t\t\t\t\t<span style="margin-left: auto; color: var(--accent); font-weight: 700;">${Utils.formatCurrency(t.price * t.quantity)}</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<textarea placeholder="Notas especiales..." onchange="updateItemNotes(${e}, this.value)" style="width: 100%; margin-top: 8px; min-height: 40px; padding: 8px; background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1); border-radius: 6px; color: var(--text); font-size: 13px;">${t.notes || ""}</textarea>\n\t\t\t\t</div>\n\t\t\t`,
          )
          .join("")),
          (document.getElementById("order-total-amount").textContent =
            Utils.formatCurrency(e)));
      }
      function changeQuantity(t, e) {
        currentOrderItems[t] &&
          ((currentOrderItems[t].quantity += e),
          currentOrderItems[t].quantity <= 0 && currentOrderItems.splice(t, 1),
          updateOrderSummary());
      }
      function removeItemFromOrder(t) {
        (currentOrderItems.splice(t, 1), updateOrderSummary());
      }
      function updateItemNotes(t, e) {
        currentOrderItems[t] && (currentOrderItems[t].notes = e);
      }
      let isSavingOrder = !1;
      async function saveOrderFromModal() {
        if (!isSavingOrder)
          if (currentOrderTable && 0 !== currentOrderItems.length) {
            isSavingOrder = !0;
            try {
              autoRefreshInterval && clearInterval(autoRefreshInterval);
              const t = currentOrderItems.reduce(
                  (t, e) => t + e.price * e.quantity,
                  0,
                ),
                e = AppState.tables.find((t) => t.id === currentOrderTable.id);
              if (!e) throw new Error("Mesa no encontrada");
              if (e.currentOrder) {
                const n = AppState.orders.find((t) => t.id === e.currentOrder);
                n &&
                  ((n.items = [...currentOrderItems]),
                  (n.total = t),
                  (n.updatedAt = new Date().toISOString()));
              } else {
                const n = {
                  id: Utils.generateId(),
                  tableId: e.id,
                  tableNumber: e.number,
                  items: [...currentOrderItems],
                  total: t,
                  status: "pending",
                  createdAt: new Date().toISOString(),
                };
                (AppState.orders.push(n),
                  (e.currentOrder = n.id),
                  (e.status = "occupied"));
              }
              (await Promise.all([
                API.save("orders", AppState.orders),
                API.save("tables", AppState.tables),
              ]),
                await loadInitialData(),
                closeOrderModal(),
                renderAllSections());
            } catch (t) {
              console.error("Error guardando pedido:", t);
              try {
                (await loadInitialData(), renderAllSections());
              } catch (t) {
                console.error("No se pudo recargar datos:", t);
              }
              alert(
                "‚ùå ERROR AL GUARDAR PEDIDO\n\nNo se pudo guardar en el servidor.\nVerifica tu conexi√≥n e intenta nuevamente.",
              );
            } finally {
              ((isSavingOrder = !1), startAutoRefresh());
            }
          } else alert("‚ö†Ô∏è Agrega al menos un producto");
      }
      function viewTableDetails(t) {
        const e = AppState.tables.find((e) => e.id === t);
        if (!e || !e.currentOrder) return;
        const n = AppState.orders.find((t) => t.id === e.currentOrder);
        if (!n) return;
        document.getElementById("table-detail-title").textContent =
          `Mesa ${e.number} - Detalle`;
        ((document.getElementById("table-detail-content").innerHTML =
          `\n\t\t\t\t<div style="margin-bottom: 20px;">\n\t\t\t\t\t<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<strong style="color: var(--accent); font-size: 18px;">Mesa ${e.number}</strong>\n\t\t\t\t\t\t\t<div class="small" style="color: var(--muted);">${Utils.formatDate(n.createdAt)}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<span class="badge badge-warning">Activo</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t\n\t\t\t\t\t<div class="order-items-list" style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; margin-bottom: 15px;">\n\t\t\t\t\t\t<h4 style="color: var(--accent); margin-bottom: 10px;">Productos</h4>\n\t\t\t\t\t\t${n.items.map((t) => `\n\t\t\t\t\t\t\t<div class="order-item-line" style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.05);">\n\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t<strong>${t.quantity}x ${t.name}</strong>\n\t\t\t\t\t\t\t\t\t${t.notes ? `<br><small style="color: var(--muted); font-size: 12px;">Nota: ${t.notes}</small>` : ""}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div style="color: var(--success); font-weight: 600;">\n\t\t\t\t\t\t\t\t\t${Utils.formatCurrency(t.price * t.quantity)}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t`).join("")}\n\t\t\t\t\t</div>\n\t\t\t\t\t\n\t\t\t\t\t<div style="text-align: right; padding: 15px; background: rgba(76, 175, 80, 0.1); border-radius: 8px; border: 2px solid var(--success);">\n\t\t\t\t\t\t<div style="font-size: 14px; color: var(--muted); margin-bottom: 5px;">Total a Pagar</div>\n\t\t\t\t\t\t<div style="font-size: 28px; font-weight: 700; color: var(--success);">\n\t\t\t\t\t\t\t${Utils.formatCurrency(n.total)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t\n\t\t\t\t\t<div style="margin-top: 20px; display: flex; gap: 10px; flex-wrap: wrap;">\n\t\t\t\t\t\t<button class="btn btn-warning" onclick="generateInvoicePDFFromModal('${n.id}')">üìÑ Generar PDF</button>\n\t\t\t\t\t\t<button class="btn btn-success" onclick="completeOrderFromModal('${n.id}')">‚úì Completar y Facturar</button>\n\t\t\t\t\t\t<button class="btn btn-secondary" onclick="closeTableDetailModal()">Cerrar</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`),
          document.getElementById("table-detail-modal").classList.add("show"));
      }
      function closeTableDetailModal() {
        document.getElementById("table-detail-modal").classList.remove("show");
      }
      async function generateInvoicePDFFromModal(t) {
        const e = AppState.orders.find((e) => e.id === t);
        e &&
          (await generateInvoicePDF(e),
          Utils.showNotification("PDF generado", "success"));
      }
      async function completeOrderFromModal(t) {
        (closeTableDetailModal(), await completeOrder(t));
      }
      async function generateCloseCash() {
        const t = Utils.getDateKey(),
          e = AppState.transactions.filter(
            (e) => Utils.getDateKeyFromISO(e.date) === t,
          ),
          n = e.reduce((t, e) => t + (e.amount || 0), 0),
          o = e.length,
          a = AppState.orders.filter(
            (e) =>
              "completed" === e.status &&
              Utils.getDateKeyFromISO(e.completedAt) === t,
          ).length;
        ((document.getElementById("close-cash-content").innerHTML =
          `\n\t\t\t\t<div class="close-cash-summary">\n\t\t\t\t\t<h2>Cierre de Caja - ${new Date().toLocaleDateString("es-MX")}</h2>\n\t\t\t\t\t<div class="close-cash-line">\n\t\t\t\t\t\t<span>Total de Ventas:</span>\n\t\t\t\t\t\t<span>${o}</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="close-cash-line">\n\t\t\t\t\t\t<span>Pedidos Completados:</span>\n\t\t\t\t\t\t<span>${a}</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="close-cash-line">\n\t\t\t\t\t\t<span>Ingreso Bruto:</span>\n\t\t\t\t\t\t<span>${Utils.formatCurrency(n)}</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="close-cash-total">\n\t\t\t\t\t\tTotal del D√≠a: ${Utils.formatCurrency(n)}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div style="margin-top: 20px; display: flex; gap: 10px;">\n\t\t\t\t\t\t<button class="btn" onclick="generateCloseCashPDF()">üìÑ Ver PDF</button>\n\t\t\t\t\t\t<button class="btn btn-success" onclick="saveCloseCash()">üíæ Guardar Cierre</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`),
          (document.getElementById("closure-history").style.display = "none"));
      }
      async function saveCloseCash() {
        const t = Utils.getDateKey(),
          e = AppState.transactions.filter(
            (e) => Utils.getDateKeyFromISO(e.date) === t,
          ),
          n = AppState.cashClosures.find((e) => e.date === t);
        if (
          n &&
          !confirm("Ya existe un cierre para hoy. ¬øDeseas actualizarlo?")
        )
          return;
        const o = e.reduce((t, e) => t + (e.amount || 0), 0),
          a = AppState.orders.filter(
            (e) =>
              "completed" === e.status &&
              Utils.getDateKeyFromISO(e.completedAt) === t,
          ).length,
          i = {
            id: n ? n.id : Utils.generateId(),
            date: t,
            totalTransactions: e.length,
            totalSales: o,
            completedOrders: a,
            transactions: e,
            createdAt: n ? n.createdAt : new Date().toISOString(),
            updatedAt: new Date().toISOString(),
          };
        if (n) {
          const t = AppState.cashClosures.findIndex((t) => t.id === i.id);
          AppState.cashClosures[t] = i;
        } else AppState.cashClosures.push(i);
        (await API.save("cash_closures", AppState.cashClosures),
          Utils.showNotification(
            "Cierre de caja guardado correctamente",
            "success",
          ));
      }
      function viewClosureHistory() {
        document.getElementById("close-cash-content").innerHTML =
          '\n\t\t\t\t<p class="text-center" style="color: var(--muted); padding: 40px;">\n\t\t\t\t\tSelecciona "Generar Cierre Actual" para ver el resumen del d√≠a o revisa el historial abajo\n\t\t\t\t</p>\n\t\t\t';
        document.getElementById("closure-history").style.display = "block";
        const t = document.querySelector("#closures-table tbody"),
          e = [...AppState.cashClosures].sort(
            (t, e) => new Date(e.date) - new Date(t.date),
          );
        0 !== e.length
          ? (t.innerHTML = e
              .map(
                (t) =>
                  `\n\t\t\t\t<tr>\n\t\t\t\t\t<td>${new Date(t.date).toLocaleDateString("es-MX")}</td>\n\t\t\t\t\t<td>${t.totalTransactions} ventas</td>\n\t\t\t\t\t<td style="color: var(--success); font-weight: 600;">${Utils.formatCurrency(t.totalSales)}</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<button class="btn btn-small btn-warning" onclick="viewClosureDetail('${t.id}')">üëÅÔ∏è Ver</button>\n\t\t\t\t\t\t<button class="btn btn-small btn-secondary" onclick="generateClosurePDF('${t.id}')">üìÑ PDF</button>\n\t\t\t\t\t\t<button class="btn btn-small btn-danger" onclick="deleteClosure('${t.id}')">üóëÔ∏è</button>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t`,
              )
              .join(""))
          : (t.innerHTML =
              '<tr><td colspan="4" class="text-center" style="color: var(--muted); padding: 40px;">No hay cierres guardados</td></tr>');
      }
      function viewClosureDetail(t) {
        const e = AppState.cashClosures.find((e) => e.id === t);
        if (!e) return;
        ((document.getElementById("close-cash-content").innerHTML =
          `\n\t\t\t\t<div class="close-cash-summary">\n\t\t\t\t\t<h2>Cierre de Caja - ${new Date(e.date).toLocaleDateString("es-MX")}</h2>\n\t\t\t\t\t<div class="close-cash-line">\n\t\t\t\t\t\t<span>Total de Ventas:</span>\n\t\t\t\t\t\t<span>${e.totalTransactions}</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="close-cash-line">\n\t\t\t\t\t\t<span>Pedidos Completados:</span>\n\t\t\t\t\t\t<span>${e.completedOrders}</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="close-cash-line">\n\t\t\t\t\t\t<span>Ingreso Bruto:</span>\n\t\t\t\t\t\t<span>${Utils.formatCurrency(e.totalSales)}</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="close-cash-total">\n\t\t\t\t\t\tTotal del D√≠a: ${Utils.formatCurrency(e.totalSales)}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div style="margin-top: 20px;">\n\t\t\t\t\t\t<button class="btn" onclick="generateClosurePDF('${e.id}')">üìÑ Ver PDF</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`),
          window.scrollTo({ top: 0, behavior: "smooth" }));
      }
      function generateClosurePDF(t) {
        const e = AppState.cashClosures.find((e) => e.id === t);
        if (!e) return;
        const { jsPDF: n } = window.jspdf,
          o = new n();
        (o.setFontSize(20),
          o.text("CIERRE DE CAJA", 105, 20, { align: "center" }),
          o.setFontSize(12),
          o.text(
            `Fecha: ${new Date(e.date).toLocaleDateString("es-MX")}`,
            105,
            30,
            { align: "center" },
          ),
          o.setLineWidth(0.5),
          o.line(20, 35, 190, 35));
        let a = 48;
        (o.setFontSize(14),
          o.text("Resumen del D√≠a", 20, a),
          (a += 10),
          o.setFontSize(11),
          o.text(`Total de Transacciones: ${e.totalTransactions}`, 20, a),
          (a += 8),
          o.text(`Pedidos Completados: ${e.completedOrders}`, 20, a),
          (a += 8),
          o.text(
            `Ingresos Totales: ${Utils.formatCurrency(e.totalSales)}`,
            20,
            a,
          ),
          (a += 15),
          e.transactions &&
            e.transactions.length > 0 &&
            (o.setFontSize(14),
            o.text("Detalle de Transacciones", 20, a),
            (a += 8),
            o.setFontSize(9),
            e.transactions.forEach((t) => {
              (a > 270 && (o.addPage(), (a = 20)),
                o.text(
                  `${new Date(t.date).toLocaleTimeString("es-MX")} - Mesa ${t.tableNumber || "-"} - ${Utils.formatCurrency(t.amount)}`,
                  20,
                  a,
                ),
                (a += 6));
            })));
        const i = o.output("blob"),
          r = URL.createObjectURL(i);
        window.open(r, "_blank");
      }
      async function deleteClosure(t) {
        confirm("¬øEliminar este cierre de caja?") &&
          ((AppState.cashClosures = AppState.cashClosures.filter(
            (e) => e.id !== t,
          )),
          await API.save("cash_closures", AppState.cashClosures),
          viewClosureHistory(),
          Utils.showNotification("Cierre eliminado", "success"));
      }
      async function generateInvoicePDF(t) {
        try {
          const { jsPDF: e } = window.jspdf,
            n = new e({ orientation: "portrait", unit: "mm", format: "a4" }),
            o = n.internal.pageSize.getWidth(),
            a = n.internal.pageSize.getHeight(),
            i = 20;
          (n.setFillColor(255, 94, 94), n.rect(0, 0, o, 45, "F"));
          const r = new Image();
          ((r.src = "/image.png"),
            await new Promise((t) => {
              ((r.onload = () => {
                try {
                  const t = document.createElement("canvas"),
                    e = 100;
                  ((t.width = e), (t.height = e));
                  const o = t.getContext("2d");
                  ((o.fillStyle = "#FFFFFF"),
                    o.fillRect(0, 0, e, e),
                    o.beginPath(),
                    o.arc(e / 2, e / 2, e / 2, 0, 2 * Math.PI),
                    o.closePath(),
                    o.clip(),
                    o.drawImage(r, 0, 0, e, e));
                  const a = t.toDataURL("image/jpeg", 0.7);
                  n.addImage(a, "JPEG", 20, 12, 20, 20);
                } catch (t) {
                  console.log("Error cargando logo:", t);
                }
                t();
              }),
                (r.onerror = () => {
                  (console.log("Logo no encontrado"), t());
                }));
            }),
            n.setTextColor(245, 235, 220),
            n.setFontSize(28),
            n.setFont(void 0, "bold"),
            n.text("LAZOS DE AMOR", 50, 22),
            n.setFontSize(12),
            n.setFont(void 0, "normal"),
            n.text("Accesorios y Detalles", 50, 30),
            n.setFontSize(20),
            n.setFont(void 0, "bold"),
            n.text("FACTURA", o - i, 25, { align: "right" }),
            n.setFontSize(10),
            n.setFont(void 0, "normal"),
            n.text(`N¬∞ ${t.id.substring(0, 8).toUpperCase()}`, o - i, 32, {
              align: "right",
            }),
            n.setTextColor(0, 0, 0));
          let s = 60;
          (n.setFontSize(11),
            n.setFont(void 0, "bold"),
            n.text("Fecha:", i, s),
            n.setFont(void 0, "normal"),
            n.text(
              new Date(t.createdAt).toLocaleString("es-CO", {
                year: "numeric",
                month: "long",
                day: "numeric",
                hour: "2-digit",
                minute: "2-digit",
              }),
              i + 20,
              s,
            ),
            t.customerData
              ? ((s += 15),
                n.setFillColor(245, 245, 245),
                n.rect(i, s - 5, o - 2 * i, 30, "F"),
                n.setFontSize(12),
                n.setFont(void 0, "bold"),
                n.setTextColor(255, 94, 94),
                n.text("DATOS DEL CLIENTE", i + 5, s + 2),
                n.setTextColor(0, 0, 0),
                n.setFontSize(10),
                n.setFont(void 0, "normal"),
                (s += 10),
                n.text(`Nombre: ${t.customerData.name}`, i + 5, s),
                (s += 6),
                n.text(`Tel√©fono: ${t.customerData.phone}`, i + 5, s),
                t.customerData.email &&
                  ((s += 6),
                  n.text(`Email: ${t.customerData.email}`, i + 5, s)),
                t.customerData.address &&
                  ((s += 6),
                  n.text(`Direcci√≥n: ${t.customerData.address}`, i + 5, s)),
                (s += 15))
              : (s += 10),
            n.setFontSize(12),
            n.setFont(void 0, "bold"),
            n.setTextColor(255, 94, 94),
            n.text("DETALLE DEL PEDIDO", i, s),
            (s += 8),
            n.setFillColor(255, 94, 94),
            n.rect(i, s - 5, o - 2 * i, 10, "F"),
            n.setTextColor(255, 255, 255),
            n.setFontSize(10),
            n.setFont(void 0, "bold"),
            n.text("Cant.", i + 3, s),
            n.text("Producto", i + 20, s),
            n.text("Precio Unit.", o - i - 55, s),
            n.text("Total", o - i - 3, s, { align: "right" }),
            (s += 10),
            n.setTextColor(0, 0, 0),
            n.setFont(void 0, "normal"));
          let d = !1;
          (t.items.forEach((t) => {
            (d &&
              (n.setFillColor(250, 250, 250),
              n.rect(i, s - 5, o - 2 * i, 8, "F")),
              (d = !d),
              n.text(t.quantity.toString(), i + 8, s, { align: "center" }),
              n.text(t.name, i + 20, s),
              n.text(`$${t.price.toLocaleString("es-CO")}`, o - i - 55, s),
              n.text(
                `$${(t.price * t.quantity).toLocaleString("es-CO")}`,
                o - i - 3,
                s,
                { align: "right" },
              ),
              (s += 8),
              t.notes &&
                (n.setFontSize(8),
                n.setTextColor(100, 100, 100),
                n.text(`Nota: ${t.notes}`, i + 20, s - 2),
                n.setFontSize(10),
                n.setTextColor(0, 0, 0),
                (s += 5)));
          }),
            (s += 10),
            n.setDrawColor(255, 94, 94),
            n.setLineWidth(0.5),
            n.line(i, s, o - i, s),
            (s += 10),
            n.setFontSize(16),
            n.setFont(void 0, "bold"),
            n.setTextColor(255, 94, 94),
            n.text("TOTAL:", o - i - 60, s),
            n.text(`$${t.total.toLocaleString("es-CO")}`, o - i - 3, s, {
              align: "right",
            }),
            n.setFillColor(245, 245, 245),
            n.rect(0, a - 30, o, 30, "F"),
            n.setFontSize(10),
            n.setFont(void 0, "normal"),
            n.setTextColor(100, 100, 100),
            n.text("Gracias por tu compra", o / 2, a - 20, { align: "center" }),
            n.setFontSize(9),
            n.text(
              "Lazos de Amor - Accesorios y Detalles | Con amor en cada detalle",
              o / 2,
              a - 14,
              { align: "center" },
            ),
            n.text(
              "¬øDudas? Cont√°ctanos al WhatsApp: +57 320 243 4814",
              o / 2,
              a - 9,
              { align: "center" },
            ));
          const l = n.output("dataurlstring"),
            c = n.output("blob"),
            u = URL.createObjectURL(c);
          return (window.open(u, "_blank"), l);
        } catch (t) {
          return (console.error("Error generando PDF:", t), null);
        }
      }
      function generateCloseCashPDF() {
        const { jsPDF: t } = window.jspdf,
          e = new t(),
          n = Utils.getDateKey(),
          o = AppState.transactions.filter(
            (t) => Utils.getDateKeyFromISO(t.date) === n,
          ),
          a = o.reduce((t, e) => t + (e.amount || 0), 0);
        (e.setFontSize(20),
          e.text("CIERRE DE CAJA", 105, 20, { align: "center" }),
          e.setFontSize(12),
          e.text(`Fecha: ${new Date().toLocaleDateString("es-MX")}`, 105, 30, {
            align: "center",
          }),
          e.text(`Hora: ${new Date().toLocaleTimeString("es-MX")}`, 105, 37, {
            align: "center",
          }),
          e.setLineWidth(0.5),
          e.line(20, 42, 190, 42));
        let i = 55;
        (e.setFontSize(14),
          e.text("Resumen del D√≠a", 20, i),
          (i += 10),
          e.setFontSize(11),
          e.text(`Total de Transacciones: ${o.length}`, 20, i),
          (i += 8),
          e.text(`Ingresos Totales: ${Utils.formatCurrency(a)}`, 20, i),
          (i += 15),
          e.setFontSize(14),
          e.text("Detalle de Transacciones", 20, i),
          (i += 8),
          e.setFontSize(9),
          o.forEach((t) => {
            (i > 270 && (e.addPage(), (i = 20)),
              e.text(
                `${new Date(t.date).toLocaleTimeString("es-MX")} - Mesa ${t.tableNumber || "-"} - ${Utils.formatCurrency(t.amount)}`,
                20,
                i,
              ),
              (i += 6));
          }));
        const r = e.output("blob"),
          s = URL.createObjectURL(r);
        window.open(s, "_blank");
      }
      function toggleMobileMenu() {
        const t = document.getElementById("sidebar"),
          e = document.querySelector(".mobile-overlay");
        (t.classList.toggle("mobile-open"), e.classList.toggle("active"));
      }
      function closeMobileMenu() {
        const t = document.getElementById("sidebar"),
          e = document.querySelector(".mobile-overlay");
        (t.classList.remove("mobile-open"), e.classList.remove("active"));
      }
      async function resetSalesData() {
        if (
          "CONFIRMAR" ===
          prompt(
            '‚ö†Ô∏è ADVERTENCIA: Esta acci√≥n eliminar√° TODOS los datos de ventas de forma PERMANENTE.\n\nSe eliminar√°n:\n‚Ä¢ Todos los pedidos\n‚Ä¢ Todas las transacciones\n‚Ä¢ Todos los cierres de caja\n‚Ä¢ Todas las facturas guardadas\n\nLos productos del cat√°logo NO se eliminar√°n.\n\nEscribe "CONFIRMAR" (en may√∫sculas) para proceder:',
          )
        )
          try {
            ((AppState.orders = []),
              await API.save("orders", []),
              (AppState.transactions = []),
              await API.save("transactions", []),
              (AppState.cashClosures = []),
              await API.save("cash_closures", []),
              alert(
                "‚úÖ Datos de ventas eliminados correctamente.\n\nLa aplicaci√≥n est√° lista para uso en producci√≥n.",
              ),
              renderDashboard(),
              renderOrders(),
              renderTransactions(),
              updateSystemInfo());
          } catch (t) {
            (alert("‚ùå Error al limpiar datos: " + t.message),
              console.error(t));
          }
        else alert("Operaci√≥n cancelada.");
      }
      function updateSystemInfo() {
        ((document.getElementById("info-menu-items").textContent =
          AppState.menuItems.length),
          (document.getElementById("info-orders").textContent =
            AppState.orders.length));
        const t = new Set();
        (AppState.orders.forEach((e) => {
          e.customerData &&
            e.customerData.name &&
            t.add(e.customerData.name.toLowerCase());
        }),
          (document.getElementById("info-customers").textContent = t.size));
        const e = AppState.transactions.filter((t) => t.invoicePDF).length;
        document.getElementById("info-invoices").textContent = e;
      }
      function logout() {
        document.getElementById("logout-modal").classList.add("show");
      }
      function closeLogoutModal() {
        document.getElementById("logout-modal").classList.remove("show");
      }
      function confirmLogout() {
        (localStorage.removeItem("userSession"),
          (window.location.href = "/login.html"));
      }
      function toggleUserMenu(t) {
        t.stopPropagation();
        const e = document.getElementById("user-menu"),
          n = document.getElementById("notifications-menu");
        (n && !n.classList.contains("hidden") && n.classList.add("hidden"),
          e.classList.toggle("hidden"));
      }
      let notificationsList = [];
      function toggleNotifications(t) {
        t.stopPropagation();
        const e = document.getElementById("notifications-menu"),
          n = document.getElementById("user-menu");
        (n && !n.classList.contains("hidden") && n.classList.add("hidden"),
          e.classList.toggle("hidden"),
          e.classList.contains("hidden") || markNotificationsAsRead());
      }
      function addNotification(t, e, n, o = null) {
        const a = {
          id: Date.now(),
          type: t,
          title: e,
          message: n,
          orderId: o,
          timestamp: new Date().toISOString(),
          read: !1,
        };
        (notificationsList.unshift(a),
          notificationsList.length > 20 &&
            (notificationsList = notificationsList.slice(0, 20)),
          updateNotificationsBadge(),
          renderNotifications());
      }
      function markNotificationsAsRead() {
        (notificationsList.forEach((t) => (t.read = !0)),
          updateNotificationsBadge(),
          renderNotifications());
      }
      function clearAllNotifications() {
        ((notificationsList = []),
          updateNotificationsBadge(),
          renderNotifications());
      }
      function updateNotificationsBadge() {
        const t = document.getElementById("notifications-badge"),
          e = notificationsList.filter((t) => !t.read).length;
        e > 0
          ? ((t.textContent = e > 9 ? "9+" : e), t.classList.remove("hidden"))
          : t.classList.add("hidden");
      }
      function renderNotifications() {
        const t = document.getElementById("notifications-list");
        0 !== notificationsList.length
          ? (t.innerHTML = notificationsList
              .map((t) => {
                const e = "order" === t.type ? "shopping_bag" : "info",
                  n = "order" === t.type ? "#FF5E5E" : "#94a3b8",
                  o = new Date(t.timestamp).toLocaleTimeString("es-ES", {
                    hour: "2-digit",
                    minute: "2-digit",
                  });
                return `\n\t\t\t\t\t<div onclick="${t.orderId ? "showSection('orders'); document.getElementById('notifications-menu').classList.add('hidden');" : ""}" style="padding: 12px; margin-bottom: 8px; background: ${t.read ? "#f8f9fa" : "#e8f5e9"}; border-radius: 8px; cursor: ${t.orderId ? "pointer" : "default"}; border-left: 3px solid ${n}; transition: all 0.2s;" onmouseover="this.style.background='${t.read ? "#f1f5f9" : "#dcedc8"}'" onmouseout="this.style.background='${t.read ? "#f8f9fa" : "#e8f5e9"}'">\n\t\t\t\t\t\t<div style="display: flex; gap: 10px; align-items: start;">\n\t\t\t\t\t\t\t<span class="material-icons-round" style="color: ${n}; font-size: 20px;">${e}</span>\n\t\t\t\t\t\t\t<div style="flex: 1;">\n\t\t\t\t\t\t\t\t<div style="font-weight: 600; color: #1e293b; font-size: 13px; margin-bottom: 4px;">${t.title}</div>\n\t\t\t\t\t\t\t\t<div style="font-size: 12px; color: #64748b; margin-bottom: 6px;">${t.message}</div>\n\t\t\t\t\t\t\t\t<div style="font-size: 11px; color: #94a3b8;">${o}</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t`;
              })
              .join(""))
          : (t.innerHTML =
              '<p style="text-align: center; color: #94a3b8; padding: 20px; font-size: 13px;">No hay notificaciones</p>');
      }
      async function enableNotifications() {
        if ("Notification" in window)
          try {
            const t = await Notification.requestPermission();
            if ((updateNotificationStatus(), "granted" === t)) {
              "vibrate" in navigator &&
                navigator.vibrate([200, 100, 200, 100, 200]);
              const t = {
                body: "Recibir√°s alertas de nuevos pedidos en tiempo real, incluso cuando la app est√© en segundo plano.",
                icon: "/image.png",
                badge: "/icon-192.png",
                tag: "test-notification",
                requireInteraction: !1,
                vibrate: [200, 100, 200, 100, 200],
              };
              if (
                "serviceWorker" in navigator &&
                navigator.serviceWorker.controller
              )
                navigator.serviceWorker.controller.postMessage({
                  type: "SHOW_NOTIFICATION",
                  title: "‚úÖ ¬°Notificaciones Activadas!",
                  options: t,
                });
              else {
                const e = new Notification("‚úÖ ¬°Notificaciones Activadas!", t);
                setTimeout(() => e.close(), 5e3);
              }
            } else
              "denied" === t &&
                alert(
                  "‚ùå Has bloqueado las notificaciones.\n\nPara activarlas:\n1. Ve a configuraci√≥n del navegador\n2. Busca 'Notificaciones' o 'Permisos'\n3. Permite notificaciones para este sitio",
                );
          } catch (t) {
            (console.error("Error al solicitar permiso de notificaciones:", t),
              alert("‚ùå Error al activar notificaciones. Intenta de nuevo."));
          }
        else alert("‚ùå Tu navegador no soporta notificaciones del sistema.");
      }
      function updateNotificationStatus() {
        const t = document.getElementById("notification-status"),
          e = document.getElementById("enable-notifications-btn");
        if (!t || !e) return;
        if (!("Notification" in window))
          return (
            (t.innerHTML =
              '\n\t\t\t\t\t<div style="background: rgba(255, 68, 68, 0.1); border-left: 4px solid #ff4444; padding: 10px;">\n\t\t\t\t\t\t‚ùå Tu navegador no soporta notificaciones del sistema\n\t\t\t\t\t</div>\n\t\t\t\t'),
            void (e.style.display = "none")
          );
        const n = Notification.permission;
        "granted" === n
          ? ((t.innerHTML =
              '\n\t\t\t\t\t<div style="background: rgba(76, 175, 80, 0.1); border-left: 4px solid #4caf50; padding: 10px;">\n\t\t\t\t\t\t‚úÖ <strong>Notificaciones Activadas</strong><br>\n\t\t\t\t\t\t<span style="color: var(--muted); font-size: 13px;">\n\t\t\t\t\t\t\tRecibir√°s alertas en tiempo real de nuevos pedidos\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t'),
            (e.textContent = "‚úÖ Notificaciones Activas"),
            (e.disabled = !0),
            (e.style.opacity = "0.6"))
          : "denied" === n
            ? ((t.innerHTML =
                '\n\t\t\t\t\t<div style="background: rgba(255, 68, 68, 0.1); border-left: 4px solid #ff4444; padding: 10px;">\n\t\t\t\t\t\t‚ùå <strong>Notificaciones Bloqueadas</strong><br>\n\t\t\t\t\t\t<span style="color: var(--muted); font-size: 13px;">\n\t\t\t\t\t\t\tDebes habilitarlas desde la configuraci√≥n del navegador\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t'),
              (e.textContent = "üîí Desbloquear en Configuraci√≥n"),
              (e.disabled = !0),
              (e.style.opacity = "0.6"))
            : ((t.innerHTML =
                '\n\t\t\t\t\t<div style="background: rgba(212, 168, 150, 0.1); border-left: 4px solid var(--beige); padding: 10px;">\n\t\t\t\t\t\t‚ö†Ô∏è <strong>Notificaciones No Configuradas</strong><br>\n\t\t\t\t\t\t<span style="color: var(--muted); font-size: 13px;">\n\t\t\t\t\t\t\tHaz clic en el bot√≥n para activarlas\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t'),
              (e.textContent = "üîî Activar Notificaciones"),
              (e.disabled = !1),
              (e.style.opacity = "1"));
      }
      (document.addEventListener("click", function (t) {
        const e = document.getElementById("user-menu"),
          n = document.getElementById("notifications-menu");
        (e && !e.classList.contains("hidden") && e.classList.add("hidden"),
          n && !n.classList.contains("hidden") && n.classList.add("hidden"));
      }),
        init());
    </script>
  </body>
</html>
